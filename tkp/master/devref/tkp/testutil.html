<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>tkp.testutil – helper functions for writing tests &mdash; LOFAR Transients Pipeline 2.0-pre documentation</title>
    
    <link rel="stylesheet" href="../../_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.0-pre',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../_static/lofar.ico"/>
    <link rel="top" title="LOFAR Transients Pipeline 2.0-pre documentation" href="../../index.html" />
    <link rel="up" title="TKP Package API Reference" href="index.html" />
    <link rel="next" title="tkp.utility – miscellaneous utility routines" href="utility/index.html" />
    <link rel="prev" title="tkp.sourcefinder.utils – Utility routines" href="sourcefinder/utils.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="utility/index.html" title="tkp.utility – miscellaneous utility routines"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="sourcefinder/utils.html" title="tkp.sourcefinder.utils – Utility routines"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">LOFAR Transients Pipeline 2.0-pre documentation</a> &raquo;</li>
          <li><a href="../index.html" >Developer&#8217;s Reference Guide</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">TKP Package API Reference</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-tkp.testutil.data">
<span id="tkp-testutil-helper-functions-for-writing-tests"></span><h1><tt class="docutils literal"><span class="pre">tkp.testutil</span></tt> &#8211; helper functions for writing tests<a class="headerlink" href="#module-tkp.testutil.data" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-tkp.testutil.db_queries">
<span id="tkp-testutil-db-queries"></span><h2><a class="reference internal" href="#module-tkp.testutil.db_queries" title="tkp.testutil.db_queries"><tt class="xref py py-mod docutils literal"><span class="pre">tkp.testutil.db_queries</span></tt></a><a class="headerlink" href="#module-tkp.testutil.db_queries" title="Permalink to this headline">¶</a></h2>
<p>A collection of back end db query subroutines used for unittesting</p>
<dl class="function">
<dt id="tkp.testutil.db_queries.convert_to_cartesian">
<tt class="descclassname">tkp.testutil.db_queries.</tt><tt class="descname">convert_to_cartesian</tt><big>(</big><em>conn</em>, <em>ra</em>, <em>decl</em><big>)</big><a class="reference internal" href="../../_modules/tkp/testutil/db_queries.html#convert_to_cartesian"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.testutil.db_queries.convert_to_cartesian" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns tuple (x,y,z)</p>
</dd></dl>

<dl class="function">
<dt id="tkp.testutil.db_queries.get_assoc_entries">
<tt class="descclassname">tkp.testutil.db_queries.</tt><tt class="descname">get_assoc_entries</tt><big>(</big><em>db</em>, <em>runcat_id</em><big>)</big><a class="reference internal" href="../../_modules/tkp/testutil/db_queries.html#get_assoc_entries"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.testutil.db_queries.get_assoc_entries" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the full history of variability indices for a runcat entry,
ordered by time.</p>
</dd></dl>

</div>
<div class="section" id="module-tkp.testutil.db_subs">
<span id="tkp-testutil-db-subs"></span><h2><a class="reference internal" href="#module-tkp.testutil.db_subs" title="tkp.testutil.db_subs"><tt class="xref py py-mod docutils literal"><span class="pre">tkp.testutil.db_subs</span></tt></a><a class="headerlink" href="#module-tkp.testutil.db_subs" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="tkp.testutil.db_subs.ExtractedSourceTuple">
<em class="property">class </em><tt class="descclassname">tkp.testutil.db_subs.</tt><tt class="descname">ExtractedSourceTuple</tt><a class="headerlink" href="#tkp.testutil.db_subs.ExtractedSourceTuple" title="Permalink to this definition">¶</a></dt>
<dd><p>ExtractedSourceTuple(ra, dec, ra_fit_err, dec_fit_err, peak, peak_err, flux, flux_err, sigma, beam_maj, beam_min, beam_angle, ew_sys_err, ns_sys_err, error_radius, fit_type)</p>
<dl class="method">
<dt id="tkp.testutil.db_subs.ExtractedSourceTuple.__getnewargs__">
<tt class="descname">__getnewargs__</tt><big>(</big><big>)</big><a class="headerlink" href="#tkp.testutil.db_subs.ExtractedSourceTuple.__getnewargs__" title="Permalink to this definition">¶</a></dt>
<dd><p>Return self as a plain tuple.  Used by copy and pickle.</p>
</dd></dl>

<dl class="method">
<dt id="tkp.testutil.db_subs.ExtractedSourceTuple.__getstate__">
<tt class="descname">__getstate__</tt><big>(</big><big>)</big><a class="headerlink" href="#tkp.testutil.db_subs.ExtractedSourceTuple.__getstate__" title="Permalink to this definition">¶</a></dt>
<dd><p>Exclude the OrderedDict from pickling</p>
</dd></dl>

<dl class="method">
<dt id="tkp.testutil.db_subs.ExtractedSourceTuple.__repr__">
<tt class="descname">__repr__</tt><big>(</big><big>)</big><a class="headerlink" href="#tkp.testutil.db_subs.ExtractedSourceTuple.__repr__" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a nicely formatted representation string</p>
</dd></dl>

<dl class="attribute">
<dt id="tkp.testutil.db_subs.ExtractedSourceTuple.beam_angle">
<tt class="descname">beam_angle</tt><a class="headerlink" href="#tkp.testutil.db_subs.ExtractedSourceTuple.beam_angle" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 11</p>
</dd></dl>

<dl class="attribute">
<dt id="tkp.testutil.db_subs.ExtractedSourceTuple.beam_maj">
<tt class="descname">beam_maj</tt><a class="headerlink" href="#tkp.testutil.db_subs.ExtractedSourceTuple.beam_maj" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 9</p>
</dd></dl>

<dl class="attribute">
<dt id="tkp.testutil.db_subs.ExtractedSourceTuple.beam_min">
<tt class="descname">beam_min</tt><a class="headerlink" href="#tkp.testutil.db_subs.ExtractedSourceTuple.beam_min" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 10</p>
</dd></dl>

<dl class="attribute">
<dt id="tkp.testutil.db_subs.ExtractedSourceTuple.dec">
<tt class="descname">dec</tt><a class="headerlink" href="#tkp.testutil.db_subs.ExtractedSourceTuple.dec" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 1</p>
</dd></dl>

<dl class="attribute">
<dt id="tkp.testutil.db_subs.ExtractedSourceTuple.dec_fit_err">
<tt class="descname">dec_fit_err</tt><a class="headerlink" href="#tkp.testutil.db_subs.ExtractedSourceTuple.dec_fit_err" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 3</p>
</dd></dl>

<dl class="attribute">
<dt id="tkp.testutil.db_subs.ExtractedSourceTuple.error_radius">
<tt class="descname">error_radius</tt><a class="headerlink" href="#tkp.testutil.db_subs.ExtractedSourceTuple.error_radius" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 14</p>
</dd></dl>

<dl class="attribute">
<dt id="tkp.testutil.db_subs.ExtractedSourceTuple.ew_sys_err">
<tt class="descname">ew_sys_err</tt><a class="headerlink" href="#tkp.testutil.db_subs.ExtractedSourceTuple.ew_sys_err" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 12</p>
</dd></dl>

<dl class="attribute">
<dt id="tkp.testutil.db_subs.ExtractedSourceTuple.fit_type">
<tt class="descname">fit_type</tt><a class="headerlink" href="#tkp.testutil.db_subs.ExtractedSourceTuple.fit_type" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 15</p>
</dd></dl>

<dl class="attribute">
<dt id="tkp.testutil.db_subs.ExtractedSourceTuple.flux">
<tt class="descname">flux</tt><a class="headerlink" href="#tkp.testutil.db_subs.ExtractedSourceTuple.flux" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 6</p>
</dd></dl>

<dl class="attribute">
<dt id="tkp.testutil.db_subs.ExtractedSourceTuple.flux_err">
<tt class="descname">flux_err</tt><a class="headerlink" href="#tkp.testutil.db_subs.ExtractedSourceTuple.flux_err" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 7</p>
</dd></dl>

<dl class="attribute">
<dt id="tkp.testutil.db_subs.ExtractedSourceTuple.ns_sys_err">
<tt class="descname">ns_sys_err</tt><a class="headerlink" href="#tkp.testutil.db_subs.ExtractedSourceTuple.ns_sys_err" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 13</p>
</dd></dl>

<dl class="attribute">
<dt id="tkp.testutil.db_subs.ExtractedSourceTuple.peak">
<tt class="descname">peak</tt><a class="headerlink" href="#tkp.testutil.db_subs.ExtractedSourceTuple.peak" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 4</p>
</dd></dl>

<dl class="attribute">
<dt id="tkp.testutil.db_subs.ExtractedSourceTuple.peak_err">
<tt class="descname">peak_err</tt><a class="headerlink" href="#tkp.testutil.db_subs.ExtractedSourceTuple.peak_err" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 5</p>
</dd></dl>

<dl class="attribute">
<dt id="tkp.testutil.db_subs.ExtractedSourceTuple.ra">
<tt class="descname">ra</tt><a class="headerlink" href="#tkp.testutil.db_subs.ExtractedSourceTuple.ra" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

<dl class="attribute">
<dt id="tkp.testutil.db_subs.ExtractedSourceTuple.ra_fit_err">
<tt class="descname">ra_fit_err</tt><a class="headerlink" href="#tkp.testutil.db_subs.ExtractedSourceTuple.ra_fit_err" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 2</p>
</dd></dl>

<dl class="attribute">
<dt id="tkp.testutil.db_subs.ExtractedSourceTuple.sigma">
<tt class="descname">sigma</tt><a class="headerlink" href="#tkp.testutil.db_subs.ExtractedSourceTuple.sigma" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 8</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="tkp.testutil.db_subs.MockSource">
<em class="property">class </em><tt class="descclassname">tkp.testutil.db_subs.</tt><tt class="descname">MockSource</tt><big>(</big><em>template_extractedsource</em>, <em>lightcurve</em><big>)</big><a class="reference internal" href="../../_modules/tkp/testutil/db_subs.html#MockSource"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.testutil.db_subs.MockSource" title="Permalink to this definition">¶</a></dt>
<dd><p>Defines a MockSource for generating mock source lists.</p>
<p>(These can be used to test the database routines.)</p>
<p>The lightcurve-dict entries define the times of non-zero
flux (we do not support time-ranges here, discretely defined datapoints are
sufficiently complex for the current unit-test suite). In this case,
any undefined datetimes requested will produce a zero-flux measurement.
A defaultdict may be supplied to simulate a steady-flux source.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>template_extractedsource</strong> (<em>ExtractedSourceTuple</em>) &#8211; This defines
everything <strong>except</strong> the flux and significance of the
extraction (i.e. position, fit error, beam properties, etc.).</li>
<li><strong>lightcurve</strong> (<a class="reference external" href="http://docs.python.org/library/stdtypes.html#dict" title="(in Python v2.7)"><em>dict</em></a>) &#8211; <p>A dict mapping datetime -&gt; flux value [Jy].
Any undefined datetimes will produce a zero-flux measurement.
A defaultdict with constant-valued default may be supplied to
represent a steady source, e.g.</p>
<blockquote>
<div>&gt;&gt;&gt;MockSource(base_source, defaultdict(lambda:steady_flux_val))</div></blockquote>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="tkp.testutil.db_subs.MockSource.simulate_extraction">
<tt class="descname">simulate_extraction</tt><big>(</big><em>db_image</em>, <em>extraction_type</em>, <em>rms_attribute='rms_min'</em><big>)</big><a class="reference internal" href="../../_modules/tkp/testutil/db_subs.html#MockSource.simulate_extraction"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.testutil.db_subs.MockSource.simulate_extraction" title="Permalink to this definition">¶</a></dt>
<dd><p>Simulate extraction process, returns extracted source or none.</p>
<p>Uses the database image properties (extraction region, rms values)
to determine if this source would be extracted in the given image,
and return an extraction or None accordingly.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>db_image</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) &#8211; Database Image object.</li>
<li><strong>extraction_type</strong> &#8211; Valid values are &#8216;blind&#8217;, &#8216;ff_nd&#8217;. If &#8216;blind&#8217;
then we only return an extracted source if the flux is above
rms_value * detection_threshold.</li>
<li><strong>rms_attribute</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#str" title="(in Python v2.7)"><em>str</em></a>) &#8211; Valid values are &#8216;rms_min&#8217;, &#8216;rms_max&#8217;.
Determines which rms value we use when deciding if this source
will be seen in a blind extraction.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">ExtractedSourceTuple or None.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="tkp.testutil.db_subs.MockSource.value_at_dtime">
<tt class="descname">value_at_dtime</tt><big>(</big><em>dtime</em>, <em>image_rms</em><big>)</big><a class="reference internal" href="../../_modules/tkp/testutil/db_subs.html#MockSource.value_at_dtime"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.testutil.db_subs.MockSource.value_at_dtime" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns an <cite>extractedsource</cite> for a given datetime.</p>
<p>If lightcurve is defined but does not contain the requested datetime,
then peak, flux, sigma are all set to zero.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="tkp.testutil.db_subs.deRuiter_radius">
<tt class="descclassname">tkp.testutil.db_subs.</tt><tt class="descname">deRuiter_radius</tt><big>(</big><em>src1</em>, <em>src2</em><big>)</big><a class="reference internal" href="../../_modules/tkp/testutil/db_subs.html#deRuiter_radius"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.testutil.db_subs.deRuiter_radius" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates the De Ruiter radius for two sources</p>
</dd></dl>

<dl class="function">
<dt id="tkp.testutil.db_subs.delete_test_database">
<tt class="descclassname">tkp.testutil.db_subs.</tt><tt class="descname">delete_test_database</tt><big>(</big><em>database</em><big>)</big><a class="reference internal" href="../../_modules/tkp/testutil/db_subs.html#delete_test_database"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.testutil.db_subs.delete_test_database" title="Permalink to this definition">¶</a></dt>
<dd><p>Use with caution!</p>
<dl class="docutils">
<dt>NB. Not the same as a freshly initialised database.</dt>
<dd>All the sequence counters are offset.</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="tkp.testutil.db_subs.example_dbimage_data_dict">
<tt class="descclassname">tkp.testutil.db_subs.</tt><tt class="descname">example_dbimage_data_dict</tt><big>(</big><em>**kwargs</em><big>)</big><a class="reference internal" href="../../_modules/tkp/testutil/db_subs.html#example_dbimage_data_dict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.testutil.db_subs.example_dbimage_data_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Defines the canonical default image-data for unit-testing the database.</p>
<p>By defining this in one place we make it simple to make changes.
A subset of the default values may be overridden by passing the keys
as keyword-args.</p>
<p>Note that while RA, Dec and extraction radius are arbitrary,
they should (usually) be close enough and large enough to enclose
the RA and Dec of any fake source extractions inserted, since the
association routines reject sources outside of designated extraction
regions.</p>
</dd></dl>

<dl class="function">
<dt id="tkp.testutil.db_subs.example_extractedsource_tuple">
<tt class="descclassname">tkp.testutil.db_subs.</tt><tt class="descname">example_extractedsource_tuple</tt><big>(</big><em>ra=123.123</em>, <em>dec=10.5</em>, <em>ra_fit_err=0.001388888888888889</em>, <em>dec_fit_err=0.0016666666666666668</em>, <em>peak=0.015</em>, <em>peak_err=0.0005</em>, <em>flux=0.015</em>, <em>flux_err=0.0005</em>, <em>sigma=15</em>, <em>beam_maj=100</em>, <em>beam_min=100</em>, <em>beam_angle=45</em>, <em>ew_sys_err=20</em>, <em>ns_sys_err=20</em>, <em>error_radius=10.0</em>, <em>fit_type=0</em><big>)</big><a class="reference internal" href="../../_modules/tkp/testutil/db_subs.html#example_extractedsource_tuple"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.testutil.db_subs.example_extractedsource_tuple" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates an example &#8216;fake extraction&#8217; for unit testing.</p>
<p>Note that while RA and Dec are arbitrary, they should (usually) be close
to the RA and Dec of any fake images used, since the association routines
reject sources outside of designated extraction regions.</p>
</dd></dl>

<dl class="function">
<dt id="tkp.testutil.db_subs.generate_timespaced_dbimages_data">
<tt class="descclassname">tkp.testutil.db_subs.</tt><tt class="descname">generate_timespaced_dbimages_data</tt><big>(</big><em>n_images</em>, <em>timedelta_between_images=datetime.timedelta(1)</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="../../_modules/tkp/testutil/db_subs.html#generate_timespaced_dbimages_data"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.testutil.db_subs.generate_timespaced_dbimages_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Generate a list of image data dictionaries.</p>
<p>The image-data dicts are identical except for having the taustart_ts
advanced by a fixed timedelta for each entry.</p>
<p>These can be used to create known entries in the image table, for
unit-testing.</p>
<p>A subset of the image-data defaults may be overridden by passing the relevant
dictionary values as keyword args.</p>
</dd></dl>

<dl class="function">
<dt id="tkp.testutil.db_subs.get_newsources_for_dataset">
<tt class="descclassname">tkp.testutil.db_subs.</tt><tt class="descname">get_newsources_for_dataset</tt><big>(</big><em>dsid</em><big>)</big><a class="reference internal" href="../../_modules/tkp/testutil/db_subs.html#get_newsources_for_dataset"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.testutil.db_subs.get_newsources_for_dataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns dicts representing all newsources for this dataset.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>dsid</strong> &#8211; Dataset id</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">list of dicts: Each dict represents one newsource.
The dict keys are all the columns in the newsources table, plus
the &#8216;taustart_ts&#8217; from the image table, which represents the
trigger time.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tkp.testutil.db_subs.get_sources_filtered_by_final_variability">
<tt class="descclassname">tkp.testutil.db_subs.</tt><tt class="descname">get_sources_filtered_by_final_variability</tt><big>(</big><em>dataset_id</em>, <em>eta_min</em>, <em>v_min</em><big>)</big><a class="reference internal" href="../../_modules/tkp/testutil/db_subs.html#get_sources_filtered_by_final_variability"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.testutil.db_subs.get_sources_filtered_by_final_variability" title="Permalink to this definition">¶</a></dt>
<dd><p>Search the database to find high-variability lightcurves.</p>
<p>Uses the variability associated with the last datapoint in a lightcurve
as the key criteria.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>dataset_id</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#int" title="(in Python v2.7)"><em>int</em></a>) &#8211; Dataset to search</li>
<li><strong>eta_min</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) &#8211; Minimum value of eta-index to return.</li>
<li><strong>v_min</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) &#8211; Minimum value of V-index to return.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">list of dicts: Each dict represents a runningcatalog_flux entry matching
the filter criteria.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tkp.testutil.db_subs.insert_image_and_simulated_sources">
<tt class="descclassname">tkp.testutil.db_subs.</tt><tt class="descname">insert_image_and_simulated_sources</tt><big>(</big><em>dataset</em>, <em>image_params</em>, <em>mock_sources</em>, <em>new_source_sigma_margin</em>, <em>deruiter_radius=3.7</em><big>)</big><a class="reference internal" href="../../_modules/tkp/testutil/db_subs.html#insert_image_and_simulated_sources"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.testutil.db_subs.insert_image_and_simulated_sources" title="Permalink to this definition">¶</a></dt>
<dd><p>Simulates the standard database image-and-source insertion logic using mock
sources.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>dataset</strong> &#8211; The dataset object</li>
<li><strong>mock_sources</strong> (<em>list of MockSource</em>) &#8211; The mock sources to simulate.</li>
<li><strong>new_source_sigma_margin</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) &#8211; Parameter passed to source-association
routines.</li>
<li><strong>deruiter_radius</strong> (<a class="reference external" href="http://docs.python.org/library/functions.html#float" title="(in Python v2.7)"><em>float</em></a>) &#8211; Parameter passed to source-association
routines.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">3-tuple (image, list of blind extractions, list of forced fits).</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tkp.testutil.db_subs.lightcurve_metrics">
<tt class="descclassname">tkp.testutil.db_subs.</tt><tt class="descname">lightcurve_metrics</tt><big>(</big><em>src_list</em><big>)</big><a class="reference internal" href="../../_modules/tkp/testutil/db_subs.html#lightcurve_metrics"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.testutil.db_subs.lightcurve_metrics" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates various metrics for a lightcurve made up of source extractions</p>
<p>These are normally calculated internally in the database - this function
serves as a sanity check, and is used for unit-testing purposes.</p>
<p>Returns a list of dictionaries, the nth dict representing the value
of the metrics after processing the first n extractions in the lightcurve.
The dict keys mirror the column names in the database, to make
cross-checking of results trivial.</p>
<p>Final note: this function is very inefficient, recalculating over the
first n extractions for each step. We could make it iterative, updating
the weighted averages as we do in the database. However, this way
provides a stronger cross-check that our iterative SQL approaches are
correct - less chance of making the same mistakes in two languages!</p>
</dd></dl>

</div>
<div class="section" id="module-tkp.testutil.decorators">
<span id="tkp-testutil-decorators"></span><h2><a class="reference internal" href="#module-tkp.testutil.decorators" title="tkp.testutil.decorators"><tt class="xref py py-mod docutils literal"><span class="pre">tkp.testutil.decorators</span></tt></a><a class="headerlink" href="#module-tkp.testutil.decorators" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="tkp.testutil.decorators.requires_test_db_managed">
<tt class="descclassname">tkp.testutil.decorators.</tt><tt class="descname">requires_test_db_managed</tt><big>(</big><big>)</big><a class="reference internal" href="../../_modules/tkp/testutil/decorators.html#requires_test_db_managed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.testutil.decorators.requires_test_db_managed" title="Permalink to this definition">¶</a></dt>
<dd><p>This decorator is used to disable tests that do potentially low level
database management operations like destroy and create. You can enable
these tests by setting the TKP_TESTDBMANAGEMENT environment variable.</p>
</dd></dl>

</div>
<div class="section" id="module-tkp.testutil.mock">
<span id="tkp-testutil-mock"></span><h2><a class="reference internal" href="#module-tkp.testutil.mock" title="tkp.testutil.mock"><tt class="xref py py-mod docutils literal"><span class="pre">tkp.testutil.mock</span></tt></a><a class="headerlink" href="#module-tkp.testutil.mock" title="Permalink to this headline">¶</a></h2>
<p>Mock data objects for use in testing.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/lofar.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#"><tt class="docutils literal"><span class="pre">tkp.testutil</span></tt> &#8211; helper functions for writing tests</a><ul>
<li><a class="reference internal" href="#module-tkp.testutil.db_queries"><tt class="docutils literal"><span class="pre">tkp.testutil.db_queries</span></tt></a></li>
<li><a class="reference internal" href="#module-tkp.testutil.db_subs"><tt class="docutils literal"><span class="pre">tkp.testutil.db_subs</span></tt></a></li>
<li><a class="reference internal" href="#module-tkp.testutil.decorators"><tt class="docutils literal"><span class="pre">tkp.testutil.decorators</span></tt></a></li>
<li><a class="reference internal" href="#module-tkp.testutil.mock"><tt class="docutils literal"><span class="pre">tkp.testutil.mock</span></tt></a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="sourcefinder/utils.html"
                        title="previous chapter"><tt class="docutils literal"><span class="pre">tkp.sourcefinder.utils</span></tt> &#8211; Utility routines</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="utility/index.html"
                        title="next chapter"><tt class="docutils literal"><span class="pre">tkp.utility</span></tt> &#8211; miscellaneous utility routines</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/devref/tkp/testutil.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="utility/index.html" title="tkp.utility – miscellaneous utility routines"
             >next</a> |</li>
        <li class="right" >
          <a href="sourcefinder/utils.html" title="tkp.sourcefinder.utils – Utility routines"
             >previous</a> |</li>
        <li><a href="../../index.html">LOFAR Transients Pipeline 2.0-pre documentation</a> &raquo;</li>
          <li><a href="../index.html" >Developer&#8217;s Reference Guide</a> &raquo;</li>
          <li><a href="index.html" >TKP Package API Reference</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2006—2014, LOFAR Transients Key Science Project.
    </div>
  </body>
</html>