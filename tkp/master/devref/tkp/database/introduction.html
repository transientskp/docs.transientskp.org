<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Introduction &mdash; LOFAR Transients Pipeline 2.1-pre documentation</title>
    
    <link rel="stylesheet" href="../../../_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.1-pre',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../../_static/lofar.ico"/>
    <link rel="top" title="LOFAR Transients Pipeline 2.1-pre documentation" href="../../../index.html" />
    <link rel="up" title="tkp.db – Database routines" href="index.html" />
    <link rel="next" title="tkp.db – TKP database root package" href="root.html" />
    <link rel="prev" title="tkp.db – Database routines" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="root.html" title="tkp.db – TKP database root package"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="tkp.db – Database routines"
             accesskey="P">previous</a> |</li>
        <li><a href="../../../index.html">LOFAR Transients Pipeline 2.1-pre documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Developer&#8217;s Reference Guide</a> &raquo;</li>
          <li><a href="../index.html" >TKP Package API Reference</a> &raquo;</li>
          <li><a href="index.html" accesskey="U"><tt class="docutils literal"><span class="pre">tkp.db</span></tt> &#8211; Database routines</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="introduction">
<span id="database-introduction"></span><h1>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h1>
<p>The database subpackage consists of several modules dedicated to their tasks.
The main modules are:</p>
<ul class="simple">
<li>database</li>
<li>general</li>
</ul>
<div class="section" id="database">
<h2>Database<a class="headerlink" href="#database" title="Permalink to this headline">¶</a></h2>
<p>The database module provides a single class,
<a class="reference internal" href="database.html#tkp.db.database.Database" title="tkp.db.database.Database"><tt class="xref py py-class docutils literal"><span class="pre">tkp.db.database.Database</span></tt></a>, which takes care of the connection to
the database. It provides a <cite>connection</cite> and a <cite>cursor</cite> object to the
database, as well as a few shortcut utility functions for executing SQL
queries.</p>
<p>The most typical use for the <a class="reference internal" href="database.html#tkp.db.database.Database" title="tkp.db.database.Database"><tt class="xref py py-class docutils literal"><span class="pre">tkp.db.database.Database</span></tt></a> class is
something as follows, assuming the default login settings (taken from the tkp
configuration file) are appropriate:</p>
<div class="highlight-python"><div class="highlight"><pre>from tkp.db import execute as execute

cursor = execute(&lt;sql query&gt;, &lt;args&gt;)
results = cursor.fetchall()
</pre></div>
</div>
<p>For more details, see the <a class="reference internal" href="database.html#database-database"><em>database</em></a> section.</p>
</div>
<div class="section" id="general-dataset-image-extracted-sources">
<h2>General: dataset, image, extracted sources<a class="headerlink" href="#general-dataset-image-extracted-sources" title="Permalink to this headline">¶</a></h2>
<p>The dataset module provides a miniature object relation mapper (ORM) interface
to the database. This interface is not fully complete, but it does allow one to
treat several database tables and their data as Python classes and instances.
The mapped tables and their classes are:</p>
<ul class="simple">
<li>datasets: DataSet</li>
<li>images: Image</li>
<li>extractedsource: ExtractedSource</li>
</ul>
<p>Each of these classes inherits from the DBOject class. This class provides
a few general methods to interface with the underlying database.
A typical usage example could look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">db_image</span> <span class="o">=</span> <span class="n">DBImage</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">image_id</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="n">database</span><span class="p">)</span>
<span class="n">db_image</span><span class="o">.</span><span class="n">insert_extracted_sources</span><span class="p">(</span><span class="n">results</span><span class="p">,</span><span class="s">&#39;blind&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>where <cite>database</cite> is the database opened above, and image_id points to an
existing row in the images table. <cite>results</cite> is obtained from the source finder,
and are stored in the database per image into extractedsource. In case of
a new image, one would leave out the <cite>id</cite> keyword in the first line, and
instead supply a <cite>data</cite> keyword argument that is a dictionary with the
necessary information (again, see the <a class="reference internal" href="database.html#database-database"><em>database documentation</em></a>).</p>
<p>Currently, the usage described above is sometimes used in the unittest code. In the pipeline
code we try to restrict the usage of the orm, since it can get quite complex.
Inserting the extracted sources for a particular image looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">tkp.db</span> <span class="kn">import</span> <span class="n">general</span> <span class="k">as</span> <span class="n">dbgen</span>
<span class="n">dbgen</span><span class="o">.</span><span class="n">insert_extracted_sources</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">results</span><span class="o">.</span><span class="n">sources</span><span class="p">,</span> <span class="s">&#39;blind&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>where image.id is the id of the image to which the sources belong to.</p>
</div>
<div class="section" id="other">
<h2>Other<a class="headerlink" href="#other" title="Permalink to this headline">¶</a></h2>
<p>The remaining modules contain the actual SQL queries used for the various database
routines, such as source insertion, source association, keeping track of the
monitoring sources and null detections, etc.
All functions and queries within each function call follow a fixed pattern:
functions inherit the connection object, and each query is executed
within a try-except block in case the database raises an error.
There is some overhead in the sense that a cursor is created
for each function call, but other than that, the routines provide
the fastest and most direct interaction with the database.</p>
<p>Several functions are called from methods of the classes in the dataset module,
to provide a hopefully clearer interface, but can of course be called directly
as well. Finally, a number of functions are private to the module, and their
name is therefore preceded with an underscore. These functions tend to be
called from another funtion within the same module, but may be called from
another module as well.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/lofar.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Introduction</a><ul>
<li><a class="reference internal" href="#database">Database</a></li>
<li><a class="reference internal" href="#general-dataset-image-extracted-sources">General: dataset, image, extracted sources</a></li>
<li><a class="reference internal" href="#other">Other</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter"><tt class="docutils literal"><span class="pre">tkp.db</span></tt> &#8211; Database routines</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="root.html"
                        title="next chapter"><tt class="docutils literal"><span class="pre">tkp.db</span></tt> &#8211; TKP database root package</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../../_sources/devref/tkp/database/introduction.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="root.html" title="tkp.db – TKP database root package"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="tkp.db – Database routines"
             >previous</a> |</li>
        <li><a href="../../../index.html">LOFAR Transients Pipeline 2.1-pre documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Developer&#8217;s Reference Guide</a> &raquo;</li>
          <li><a href="../index.html" >TKP Package API Reference</a> &raquo;</li>
          <li><a href="index.html" ><tt class="docutils literal"><span class="pre">tkp.db</span></tt> &#8211; Database routines</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2006—2015, LOFAR Transients Key Science Project.
    </div>
  </body>
</html>