<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>tkp.db.associations – source association &mdash; LOFAR Transients Pipeline 2.0.0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '2.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../../_static/lofar.ico"/>
    <link rel="top" title="LOFAR Transients Pipeline 2.0.0 documentation" href="../../../index.html" />
    <link rel="up" title="tkp.db – Database routines" href="index.html" />
    <link rel="next" title="tkp.db.configstore – Key-value record of job configuration params" href="configstore.html" />
    <link rel="prev" title="tkp.db – TKP database root package" href="root.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="configstore.html" title="tkp.db.configstore – Key-value record of job configuration params"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="root.html" title="tkp.db – TKP database root package"
             accesskey="P">previous</a> |</li>
        <li><a href="../../../index.html">LOFAR Transients Pipeline 2.0.0 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Developer&#8217;s Reference Guide</a> &raquo;</li>
          <li><a href="../index.html" >TKP Package API Reference</a> &raquo;</li>
          <li><a href="index.html" accesskey="U"><tt class="docutils literal"><span class="pre">tkp.db</span></tt> &#8211; Database routines</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-tkp.db.associations">
<span id="tkp-db-associations-source-association"></span><span id="database-associations"></span><h1><a class="reference internal" href="#module-tkp.db.associations" title="tkp.db.associations: Database source association"><tt class="xref py py-mod docutils literal"><span class="pre">tkp.db.associations</span></tt></a> &#8211; source association<a class="headerlink" href="#module-tkp.db.associations" title="Permalink to this headline">¶</a></h1>
<p>A collection of back end subroutines (mostly SQL queries), In this module we
deal with source association.</p>
<dl class="function">
<dt id="tkp.db.associations._check_meridian_wrap">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_check_meridian_wrap</tt><big>(</big><em>image_id</em><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_check_meridian_wrap"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._check_meridian_wrap" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks whether an image is close to the meridian ra = 0 or ra = 360</p>
<p>When so, the association query needs to be rewritten to take into account
sources across the 0/360 meridian.</p>
<p>The query returns:</p>
<dl class="docutils">
<dt>q_across: true, if the extraction region of the image crosses</dt>
<dd>the ra=0/360 border</dd>
<dt>ra_min:   the min value of the ra-between for the normal case,</dt>
<dd>when the image is outside the ra=0/360 meridian,
otherwise NULL</dd>
<dt>ra_max:   the max value of the ra-between for the normal case,</dt>
<dd>when the image is outside the ra=0/360 meridian,
otherwise NULL</dd>
</dl>
<p>ra_min1/max1 and ra_min2/max2 are the values which may be used
for the case of a cross-meridian image.
F.ex. using a search radius of 5 degrees, and when a source is at
359.99 the ra-betweens 1 and 2 are :
... AND (ra BETWEEN ra_min1 AND ra_max1 OR ra BETWEEN ra_min2 AND ra_max2) ...
... AND (ra BETWEEN 354.99 AND 360 OR ra BETWEEN 0 AND 4.99) ...</p>
<dl class="docutils">
<dt>ra_min1:  the min value of the high-end ra-between, if the</dt>
<dd>extraction region of the image crosses the ra=0/360 border,
otherwise NULL</dd>
<dt>ra_max1:  the min value of the high-end ra-between, if the</dt>
<dd>extraction region of the image crosses the ra=0/360 border,
otherwise NULL</dd>
</dl>
<p>ra_min2, ra_max2: As ra_min1/max1, but for the low-end ra values.</p>
<p>These values are not being used in the cross-meridian association query,
but are merely reported to notice the search area.
The cross-meridian association query uses the cartesian dot product,
to get the search area.</p>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._delete_1_to_many_inactive_assocskyrgn">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_delete_1_to_many_inactive_assocskyrgn</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_delete_1_to_many_inactive_assocskyrgn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._delete_1_to_many_inactive_assocskyrgn" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete the assocskyrgn links of the old runcat</p>
<p>Since we replaced this runcat.id with multiple new ones, we now
delete the old links.</p>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._delete_1_to_many_inactive_assocxtrsource">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_delete_1_to_many_inactive_assocxtrsource</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_delete_1_to_many_inactive_assocxtrsource"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._delete_1_to_many_inactive_assocxtrsource" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete the association pairs of the old runcat from assocxtrsource</p>
<p>NOTE: It might sound confusing, but those are not qualified
as inactive in tempruncat (read below).
Since we replaced this runcat.id with multiple new one, we first
flag it as inactive, after which we delete it from the runningcatalog</p>
<p>The subselect selects those valid &#8220;old&#8221; runcat ids (i.e.,
the ones that were not set to inactive for the many-to-many associations).</p>
<dl class="docutils">
<dt>NOTE: We do not have to flag these rows as inactive,</dt>
<dd>no furthr processing depends on these in the assoc run</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._delete_1_to_many_inactive_newsource">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_delete_1_to_many_inactive_newsource</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_delete_1_to_many_inactive_newsource"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._delete_1_to_many_inactive_newsource" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete the newsource sources of the old runcat</p>
<p>Since we replaced this runcat.id with multiple new ones, we now
delete the old one.</p>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._delete_1_to_many_inactive_runcat_flux">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_delete_1_to_many_inactive_runcat_flux</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_delete_1_to_many_inactive_runcat_flux"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._delete_1_to_many_inactive_runcat_flux" title="Permalink to this definition">¶</a></dt>
<dd><p>Flag the old runcat ids in the runningcatalog to inactive</p>
<p>Since we replaced this runcat.id with multiple new one, we first
flag it as inactive, after which we delete it from the runningcatalog</p>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._delete_bad_blind_extractions">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_delete_bad_blind_extractions</tt><big>(</big><em>image_id</em><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_delete_bad_blind_extractions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._delete_bad_blind_extractions" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove blind extractions centred outside designated extract region.</p>
<p>These occur sometimes due to highly elliptical fits on noisy data,
creating a best fit centred outside the original pixel region.
The source-extraction code has been modified to (probably) prevent this,
but we check for them anyway.</p>
<p>NB. We currently only delete blind extractions.
We expect that occasionally forced fits to sources just inside the extraction
radius might converge just outside, but these should be restricted to a
very small additional margin. By not deleting these edge cases,
the data allows us to construct proper lightcurves, and (I think) does
not contribute to their weighted mean positions (so sources cannot &#8216;migrate&#8217;
across the border).
TODO(TS): Check this.</p>
<p>Only extractions from the specified image are checked for deletion.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body">Number of extractedsource rows deleted.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._delete_inactive_runcat">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_delete_inactive_runcat</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_delete_inactive_runcat"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._delete_inactive_runcat" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete the one-to-many associations from temprunningcatalog,
and delete the inactive rows from runningcatalog.</p>
<p>After the one-to-many associations have been processed,
they can be deleted from the temporary table and
the runningcatalog.</p>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._determine_newsource_previous_limits">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_determine_newsource_previous_limits</tt><big>(</big><em>image_id</em>, <em>new_source_sigma_margin</em><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_determine_newsource_previous_limits"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._determine_newsource_previous_limits" title="Permalink to this definition">¶</a></dt>
<dd><p>Determines which new-runcat sources are also probably transient.</p>
<p>Looks up previous images relevant to this source-position, using the
following criteria - images must:</p>
<blockquote>
<div><ul class="simple">
<li>overlap the new-source position, according to the skyregion
information;</li>
<li>be in the same dataset;</li>
<li>be in the same frequency band;</li>
<li>have an earlier timestamp than the current image;</li>
<li>have not been rejected.</li>
</ul>
</div></blockquote>
<p>For those images we calculate the per-previous-image detection-thresholds,
which are defined as follows.</p>
<p>A new source is &#8216;possibly transient&#8217; (type 0) if it
passes the following tests:</p>
<blockquote>
<div><ul>
<li><p class="first">Was not detected in a skyregion being surveyed for the first time.</p>
</li>
<li><p class="first">Has a flux-value such that:</p>
<blockquote>
<div><p>flux &gt; MIN_OVER_I [ (rms_min_I*(det_I + new_source_sigma_margin) ]</p>
</div></blockquote>
</li>
</ul>
<blockquote>
<div>(where I indexes the images)
i.e. if it was a steady-source, it should have been already detected if
it was in the <em>low-RMS</em> area of the previous image with best detection
threshold, even allowing for noise fluctuations.</div></blockquote>
</div></blockquote>
<p>Furthermore, a new source is &#8216;likely transient&#8217; (type 1) if it is additionally
bright enough that, if it were a steady source, it should have been detected
even if it was in the <em>high-RMS</em> area of the aforementioned &#8216;low rms_min&#8217;
image, i.e.</p>
<blockquote>
<div>flux &gt; (rms_max_I*(det_I + new_source_sigma_margin))</div></blockquote>
<p>Note that, once we have located the image with best &#8216;low rms threshold&#8217;,
we then use that image to <em>also</em> generate the &#8216;high rms threshold&#8217;.
Strictly speaking, this is non-optimal - we should run a fresh search
against all images to find the best &#8216;high rms threshold&#8217;. However, I&#8217;m
working on the assumption that most of
the time the image with best low-threshold will also have best
high-threshold, and even when that is not the case we won&#8217;t lose too much
accuracy. The benefits of this assumption are simplicity, and possibly
faster performance, but this might need to be re-examined in future,
especially if we start ingesting images of wildly differing sizes and
noise non-uniformity characteristics (e.g. single pointings vs mosaics) etc.</p>
<p>We use peak flux (f_peak) as the flux value here, since that is likely
to be the deciding factor in whether a source gets blindly extracted or not.
(NB This is a hunch, rigorous investigation welcome.)</p>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._empty_temprunningcatalog">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_empty_temprunningcatalog</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_empty_temprunningcatalog"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._empty_temprunningcatalog" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize the temporary storage table</p>
<p>Initialize the temporary table temprunningcatalog which contains
the current observed sources.</p>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._flag_1_to_many_inactive_runcat">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_flag_1_to_many_inactive_runcat</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_flag_1_to_many_inactive_runcat"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._flag_1_to_many_inactive_runcat" title="Permalink to this definition">¶</a></dt>
<dd><p>Flag the old runcat ids in the runningcatalog to inactive</p>
<p>We do not delete them yet, because we still need to clear up all the
superseded entries in assocskyrgn, etc.</p>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._flag_1_to_many_inactive_tempruncat">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_flag_1_to_many_inactive_tempruncat</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_flag_1_to_many_inactive_tempruncat"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._flag_1_to_many_inactive_tempruncat" title="Permalink to this definition">¶</a></dt>
<dd><p>Flag the one-to-many associations from temprunningcatalog.</p>
<p>(Since we are done processing them, now.)</p>
<p>We do not delete them yet- if we did,
we would not be able to cross-match extractedsources to determine
which sources did not have a match in temprunningcatalog (&#8216;new&#8217; sources).</p>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._flag_many_to_many_tempruncat">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_flag_many_to_many_tempruncat</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_flag_many_to_many_tempruncat"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._flag_many_to_many_tempruncat" title="Permalink to this definition">¶</a></dt>
<dd><p>Select the many-to-many association pairs in temprunningcatalog.</p>
<p>By flagging the many-to-many associations, we reduce the
processing to one-to-many and many-to-one (identical to one-to-one)
relationships</p>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._insert_1_to_1_assoc">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_insert_1_to_1_assoc</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_insert_1_to_1_assoc"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._insert_1_to_1_assoc" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert remaining associations from temprunningcatalog into assocxtrsource.</p>
<p>We also calculate the variability indices at the timestamp of the
the current image.</p>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._insert_1_to_1_runcat_flux">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_insert_1_to_1_runcat_flux</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_insert_1_to_1_runcat_flux"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._insert_1_to_1_runcat_flux" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert the fluxes in runningcatalog_flux of a new band
for an existing runcat source.</p>
<p>If the runcat, band, stokes entry does not exist (yet) in runcat_flux,
we need to insert the new values from tempruncat.
This might be the case if a source has been observed at other frequencies,
but not in the current band, so there does not exist an entry
for this band.</p>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._insert_1_to_many_assocskyrgn">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_insert_1_to_many_assocskyrgn</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_insert_1_to_many_assocskyrgn"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._insert_1_to_many_assocskyrgn" title="Permalink to this definition">¶</a></dt>
<dd><p>Copy skyregion associations from old runcat entries for new one-to-many
runningcatalog entries.</p>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._insert_1_to_many_basepoint_assocxtrsource">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_insert_1_to_many_basepoint_assocxtrsource</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_insert_1_to_many_basepoint_assocxtrsource"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._insert_1_to_many_basepoint_assocxtrsource" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert &#8216;base points&#8217; for one-to-many associations</p>
<p>Before continuing, we have to insert the &#8216;base points&#8217; of the associations,
i.e. the links between the new runningcatalog entries
and their associated (new) extractedsources.</p>
<p>We also calculate the variability indices at the timestamp of the
the current image.</p>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._insert_1_to_many_newsource">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_insert_1_to_many_newsource</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_insert_1_to_many_newsource"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._insert_1_to_many_newsource" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the runcat id for the one-to-many associations,
and delete the newsource entries of the old runcat id
(the new ones have been added earlier).</p>
<p>In this case, new entries in the runningcatalog and runningcatalog_flux
were already added (for every extractedsource one), which will replace
the existing ones in the runningcatalog.
Therefore, we have to update the references to these new ids as well.</p>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._insert_1_to_many_replacement_assocxtrsource">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_insert_1_to_many_replacement_assocxtrsource</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_insert_1_to_many_replacement_assocxtrsource"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._insert_1_to_many_replacement_assocxtrsource" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert links into the association table between the new runcat
entries and the old extractedsources.
(New to New (&#8216;basepoint&#8217;) links have been added earlier).</p>
<p>In this case, new entries in the runningcatalog and runningcatalog_flux
were already added (for every extractedsource one), which will replace
the existing ones in the runningcatalog.
Therefore, we have to update the references to these new ids as well.
So, we will append to assocxtrsource and delete the entries from
runningcatalog_flux.</p>
<p>NOTE:
1. We do not update the distance_arcsec and r values of the pairs.</p>
<p>TODO:
1. Why not?</p>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._insert_1_to_many_runcat">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_insert_1_to_many_runcat</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_insert_1_to_many_runcat"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._insert_1_to_many_runcat" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert the extracted sources that belong to one-to-many
associations in the runningcatalog.</p>
<p>Since for the one-to-many associations (i.e. one runcat source
associated with multiple extracted sources) we cannot a priori
decide which counterpart pair is the correct one, or whether all
are correct (in the case of a higher-resolution image),
all extracted sources are added as a new source to
the runningcatalog, and they will replace the (old; lower resolution)
runcat source of the association.</p>
<p>As a consequence of this, the resolution of the runningcatalog
is increasing over time.</p>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._insert_1_to_many_runcat_flux">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_insert_1_to_many_runcat_flux</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_insert_1_to_many_runcat_flux"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._insert_1_to_many_runcat_flux" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert the fluxes of the extracted sources that belong
to a one-to-many association in the runningcatalog.</p>
<p>Analogous to the runningcatalog, extracted source properties
are added to the runningcatalog_flux table.</p>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._insert_new_assocxtrsource">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_insert_new_assocxtrsource</tt><big>(</big><em>image_id</em><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_insert_new_assocxtrsource"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._insert_new_assocxtrsource" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert new associations for previously unknown sources.</p>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._insert_new_runcat">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_insert_new_runcat</tt><big>(</big><em>image_id</em><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_insert_new_runcat"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._insert_new_runcat" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert previously unknown sources into the <tt class="docutils literal"><span class="pre">runningcatalog</span></tt> table.</p>
<p>Extractedsources for which no counterpart was found in the
runningcatalog (i.e. no pair exists in tempruncat),
will be added as a new source to the assocxtrsource,
runningcatalog and runningcatalog_flux tables.</p>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._insert_new_runcat_flux">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_insert_new_runcat_flux</tt><big>(</big><em>image_id</em><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_insert_new_runcat_flux"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._insert_new_runcat_flux" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert previously unknown sources into the <tt class="docutils literal"><span class="pre">runningcatalog_flux</span></tt> table.</p>
<p>(i.e. those without <em>any</em> previous runcat-counterpart)</p>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._insert_new_runcat_skyrgn_assocs">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_insert_new_runcat_skyrgn_assocs</tt><big>(</big><em>image_id</em><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_insert_new_runcat_skyrgn_assocs"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._insert_new_runcat_skyrgn_assocs" title="Permalink to this definition">¶</a></dt>
<dd><p>Process newly created entries from the runningcatalog,
determine which skyregions they lie within.</p>
<p>Upon creation of a new runningcatalog entry,
we need to determine which previous fields of view (skyrgns)
we expect to see it in.
This knowledge helps us to make accurate guesses as whether a new
source is really transient or simply being surveyed for the first time.</p>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._insert_temprunningcatalog">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_insert_temprunningcatalog</tt><big>(</big><em>image_id</em>, <em>deRuiter_r</em>, <em>mw</em><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_insert_temprunningcatalog"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._insert_temprunningcatalog" title="Permalink to this definition">¶</a></dt>
<dd><p>Select matched sources</p>
<p>Here we select the extractedsource that have a positional match
with the sources in the running catalogue table (runningcatalog).
Those sources which <em>do</em> have a potential match, will be inserted into the
temporary running catalogue table (temprunningcatalog).</p>
<p>See also:
<a class="reference external" href="http://docs.transientskp.org/tkp/database/schema.html#temprunningcatalog">http://docs.transientskp.org/tkp/database/schema.html#temprunningcatalog</a></p>
<p>Explanation of some column name prefixes/suffixes used in the SQL query:</p>
<ul>
<li><p class="first">avg_X := average of X</p>
</li>
<li><p class="first">avg_X_sq := average of X^2</p>
</li>
<li><p class="first">avg_weight_X := average of weight of X, i.e. mean( 1/error^2 )</p>
</li>
<li><dl class="first docutils">
<dt>avg_weighted_X := average of weighted X,</dt>
<dd><p class="first last">i.e. mean(X/error^2)</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>avg_weighted_X_sq := average of weighted X^2,</dt>
<dd><p class="first last">i.e. mean(X^2/error^2)</p>
</dd>
</dl>
</li>
</ul>
<p>This result set might contain multiple associations (1-n,n-1)
for a single known source in runningcatalog.</p>
<p>The n-1 assocs will be treated similar as n 1-1 assocs.</p>
<p>NOTE: Beware of the extra condition on x0.image in the WHERE clause,
preventing the query to grow exponentially in response time</p>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._update_1_to_1_runcat">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_update_1_to_1_runcat</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_update_1_to_1_runcat"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._update_1_to_1_runcat" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the running catalog with the values in temprunningcatalog</p>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._update_1_to_1_runcat_flux">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_update_1_to_1_runcat_flux</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_update_1_to_1_runcat_flux"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._update_1_to_1_runcat_flux" title="Permalink to this definition">¶</a></dt>
<dd><p>Updates the fluxes in runningcatalog_flux of an existing band
for an existing runcat source.</p>
<p>If the runcat, band, stokes entry does exist in runcat_flux,
it will be updated with the values from tempruncat.</p>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations._update_ff_runcat_extractedsource">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">_update_ff_runcat_extractedsource</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#_update_ff_runcat_extractedsource"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations._update_ff_runcat_extractedsource" title="Permalink to this definition">¶</a></dt>
<dd><p>We are about to delete the runcats that are inactivated, and
therefore have to set the ff_runcat reference in extractedsource to NULL.</p>
</dd></dl>

<dl class="function">
<dt id="tkp.db.associations.associate_extracted_sources">
<tt class="descclassname">tkp.db.associations.</tt><tt class="descname">associate_extracted_sources</tt><big>(</big><em>image_id</em>, <em>deRuiter_r</em>, <em>new_source_sigma_margin</em><big>)</big><a class="reference internal" href="../../../_modules/tkp/db/associations.html#associate_extracted_sources"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.db.associations.associate_extracted_sources" title="Permalink to this definition">¶</a></dt>
<dd><p>Associate extracted sources with sources detected in the running
catalog.</p>
<p>See the &#8220;developer&#8217;s reference&#8221; section of the docs for a step-by-step
breakdown of the logic encapsulated here.</p>
<p>The dimensionless distance between two sources is given by the
&#8220;De Ruiter radius&#8221;, see Chapters 2 &amp; 3 of Scheers&#8217; thesis.</p>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/lofar.png" alt="Logo"/>
            </a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="root.html"
                        title="previous chapter"><tt class="docutils literal"><span class="pre">tkp.db</span></tt> &#8211; TKP database root package</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="configstore.html"
                        title="next chapter"><tt class="docutils literal"><span class="pre">tkp.db.configstore</span></tt> &#8211; Key-value record of job configuration params</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../../_sources/devref/tkp/database/association.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="configstore.html" title="tkp.db.configstore – Key-value record of job configuration params"
             >next</a> |</li>
        <li class="right" >
          <a href="root.html" title="tkp.db – TKP database root package"
             >previous</a> |</li>
        <li><a href="../../../index.html">LOFAR Transients Pipeline 2.0.0 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Developer&#8217;s Reference Guide</a> &raquo;</li>
          <li><a href="../index.html" >TKP Package API Reference</a> &raquo;</li>
          <li><a href="index.html" ><tt class="docutils literal"><span class="pre">tkp.db</span></tt> &#8211; Database routines</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2006—2015, LOFAR Transients Key Science Project.
    </div>
  </body>
</html>