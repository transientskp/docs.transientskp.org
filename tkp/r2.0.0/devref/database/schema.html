<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Schema reference &mdash; LOFAR Transients Pipeline 2.0.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../_static/lofar.ico"/>
    <link rel="top" title="LOFAR Transients Pipeline 2.0.0 documentation" href="../../index.html" />
    <link rel="up" title="The Pipeline Database" href="index.html" />
    <link rel="next" title="Source Association Logic" href="assoc.html" />
    <link rel="prev" title="The Pipeline Database" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="assoc.html" title="Source Association Logic"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="The Pipeline Database"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">LOFAR Transients Pipeline 2.0.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Developer&#8217;s Reference Guide</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">The Pipeline Database</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="schema-reference">
<span id="database-schema"></span><h1>Schema reference<a class="headerlink" href="#schema-reference" title="Permalink to this headline">¶</a></h1>
<a class="reference internal image-reference" href="../../_images/schema.png"><img alt="../../_images/schema.png" src="../../_images/schema.png" style="width: 408.6px; height: 591.0px;" /></a>
<p>Note that this diagram is periodically updated and may not reliably reflect
the current status of the development version.</p>
<div class="section" id="table-listing">
<h2>Table Listing<a class="headerlink" href="#table-listing" title="Permalink to this headline">¶</a></h2>
<div class="section" id="assocxtrsource">
<span id="schema-assocxtrsource"></span><h3>assocxtrsource<a class="headerlink" href="#assocxtrsource" title="Permalink to this headline">¶</a></h3>
<p>This table stores the association between an extracted source and its
runningcatalog counterpart source, where the relation might be of type 1-1, 1-n
or n-1.</p>
<dl class="docutils">
<dt><strong>runcat</strong></dt>
<dd>A reference to the <tt class="docutils literal"><span class="pre">runcatid</span></tt> in <tt class="docutils literal"><span class="pre">runningcatalog</span></tt>.  It may be regarded
as the &#8220;base&#8221; identitfier of a lightcurve, whereas the lightcurve consist
of multiple frequency bands and Stokes parameters.</dd>
<dt><strong>xtrsrc</strong></dt>
<dd>This is the ID of the extracted source that could be associated to
runningcatalog source.  Together, the <tt class="docutils literal"><span class="pre">runcat_id</span></tt> and the <tt class="docutils literal"><span class="pre">xtrsrc</span></tt> form
a unique pair.</dd>
<dt><strong>type</strong></dt>
<dd><p class="first">Type of association, and its description.  n-m, where n is the number of
<tt class="docutils literal"><span class="pre">runningcatalog</span></tt> sources, and m the number of extracted sources. (The
assignment of numbers is to association types is arbitrary.)</p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">type</span> <span class="pre">=</span> <span class="pre">2</span></tt></dt>
<dd>Base point of a 1-n (one-to-many) association (relates to <tt class="docutils literal"><span class="pre">type</span> <span class="pre">=</span> <span class="pre">6</span></tt>)</dd>
<dt><tt class="docutils literal"><span class="pre">type</span> <span class="pre">=</span> <span class="pre">3</span></tt></dt>
<dd>1-1 association.</dd>
<dt><tt class="docutils literal"><span class="pre">type</span> <span class="pre">=</span> <span class="pre">4</span></tt></dt>
<dd>0-1 (zero-to-one) association, i.e. a new source.</dd>
<dt><tt class="docutils literal"><span class="pre">type</span> <span class="pre">=</span> <span class="pre">6</span></tt></dt>
<dd>Associations of 1-n (one-to-many) type. These are updates of
pre-existing associations, due to the 1-n case (relates to <tt class="docutils literal"><span class="pre">type</span> <span class="pre">=</span>
<span class="pre">2</span></tt> association).</dd>
<dt><tt class="docutils literal"><span class="pre">type</span> <span class="pre">=</span> <span class="pre">7</span></tt></dt>
<dd>Forced-fit to position of the null detection of a known source.</dd>
<dt><tt class="docutils literal"><span class="pre">type</span> <span class="pre">=</span> <span class="pre">8</span></tt></dt>
<dd>Initial forced fit to a monitoring list position.</dd>
<dt><tt class="docutils literal"><span class="pre">type</span> <span class="pre">=</span> <span class="pre">9</span></tt></dt>
<dd>Subsequent forced fit to a monitoring list position (relates to
<tt class="docutils literal"><span class="pre">type</span> <span class="pre">=</span> <span class="pre">8</span></tt>.</dd>
</dl>
</div></blockquote>
<p class="last">Note that many-to-1 relations reduce to 1-to-1 and 1-to-many associations.
Therefore, there is no type specifying such a case.</p>
</dd>
<dt><strong>distance_arcsec</strong></dt>
<dd>The distance in arcsec between the associated sources, calculated by the
database using the dot product Cartesian coordinates</dd>
<dt><strong>r</strong></dt>
<dd>The dimensionless distance (De Ruiter radius) between the associated
sources. It is determined as the positional differences weighted by the
errors, calculated by the association procedure inside the database
(<a class="reference internal" href="../../bibliography.html#scheers-2011"><em>Scheers, 2011</em></a>, chapter 3).</dd>
<dt><strong>loglr</strong></dt>
<dd>The logarithm of the likelihood ratio of the associated sources, defaults to
<tt class="docutils literal"><span class="pre">NULL</span></tt> if not calculated (<a class="reference internal" href="../../bibliography.html#scheers-2011"><em>Scheers, 2011</em></a>, chapter 3).</dd>
<dt><strong>v_int</strong></dt>
<dd>The flux <a class="reference external" href="http://en.wikipedia.org/wiki/Coefficient_of_variation">coefficient of variation</a> , <span class="math">\(V_{\nu}\)</span>,
based on the integrated flux values up to this datapoint.</dd>
<dt><strong>eta_int</strong></dt>
<dd>The &#8216;reduced chi-squared&#8217; variability index, <span class="math">\(\eta_{\nu}\)</span>, based on
the integrated flux values up to this datapoint.</dd>
<dt><strong>f_datapoints</strong></dt>
<dd>The number of flux datapoints (including the extractedsource
referenced in this entry) used to calculate the variability indices.</dd>
</dl>
</div>
<div class="section" id="assocskyrgn">
<span id="schema-assocskyrgn"></span><h3>assocskyrgn<a class="headerlink" href="#assocskyrgn" title="Permalink to this headline">¶</a></h3>
<p>(See also <a class="reference internal" href="#schema-skyregion"><em>skyregion table</em></a>.)</p>
<p>This table records which <a class="reference internal" href="#schema-runningcatalog"><em>runningcatalog</em></a> sources
we expect to see in any given skyregion. This serves two purposes: it allows
us to determine when we <em>do not</em> see previously detected sources, presumably
because they have dropped in flux (see
<a class="reference internal" href="../tkp/database/nulldetections.html#tkp.db.nulldetections.get_nulldetections" title="tkp.db.nulldetections.get_nulldetections"><tt class="xref py py-func docutils literal"><span class="pre">tkp.db.nulldetections.get_nulldetections()</span></tt></a>).  It also allows us to
determine whether a new runningcatalog entry (i.e.  a newly detected source
without associated historical detections) is being detected for the first time
because it is actually a new transient, or if it is simply the first time that
region of sky has been surveyed (see
<a class="reference internal" href="../tkp/database/association.html#tkp.db.associations._determine_newsource_previous_limits" title="tkp.db.associations._determine_newsource_previous_limits"><tt class="xref py py-func docutils literal"><span class="pre">tkp.db.associations._determine_newsource_previous_limits()</span></tt></a>).</p>
<p>This table is updated under 2 circumstances:</p>
<ul class="simple">
<li>A new skyregion is processed, and associations must be made with pre-existing
runcat entries (see SQL function <tt class="docutils literal"><span class="pre">updateSkyRgnMembers</span></tt>).</li>
<li>A new runningcatalog source is added, and must be associated with pre-existing
skyregions
(see <a class="reference internal" href="../tkp/database/association.html#tkp.db.associations._insert_new_runcat_skyrgn_assocs" title="tkp.db.associations._insert_new_runcat_skyrgn_assocs"><tt class="xref py py-func docutils literal"><span class="pre">tkp.db.associations._insert_new_runcat_skyrgn_assocs()</span></tt></a>).</li>
</ul>
<dl class="docutils">
<dt><strong>runcat</strong></dt>
<dd>References the associated <tt class="docutils literal"><span class="pre">runningcatalog</span></tt> ID.</dd>
<dt><strong>skyrgn</strong></dt>
<dd>References the associated <tt class="docutils literal"><span class="pre">skyregion</span></tt> ID.</dd>
<dt><strong>distance_deg</strong></dt>
<dd>Records the angular separation between the <tt class="docutils literal"><span class="pre">runningcatalog</span></tt> source and the
<tt class="docutils literal"><span class="pre">skyregion</span></tt> centre, at time of first association.</dd>
</dl>
</div>
<div class="section" id="config">
<span id="schema-config"></span><h3>config<a class="headerlink" href="#config" title="Permalink to this headline">¶</a></h3>
<p>A simple table of <tt class="docutils literal"><span class="pre">(dataset,</span> <span class="pre">section,</span> <span class="pre">key,</span> <span class="pre">value,</span> <span class="pre">type)</span></tt> tuples, providing a
means of recording the contents of the <a class="reference internal" href="../../userref/config/job_params_cfg.html#job-params-cfg"><em>job_params.cfg - Job Parameters Configuration</em></a> file used to
initiate a particular TraP processing run.
This provides provenance and reproducibility for any given dataset.</p>
</div>
<div class="section" id="dataset">
<span id="schema-dataset"></span><h3>dataset<a class="headerlink" href="#dataset" title="Permalink to this headline">¶</a></h3>
<p>The dataset table provides an id for grouping together results,
usually from a single run of the TraP.
As such, it represents a collection of images processed with a particular
configuration (see also the <a class="reference internal" href="#config">config</a> table).</p>
<p>Note that it is possible to specify a dataset_id in order to process more
recent images as part of a pre-existing dataset, in which case the previously
stored configuration is loaded from the <a class="reference internal" href="#config">config</a> table, to ensure consistency across
the dataset.</p>
<dl class="docutils">
<dt><strong>id</strong></dt>
<dd>Every dataset gets a unique ID. The ID is generated by the database.</dd>
<dt><strong>rerun</strong></dt>
<dd>The value indicates how many times a dataset with a given description was
processed by the pipeline. Note that every dataset still has a unique id,
even when it was reprocessed.  At insertion time this is incremented by 1
when the description of the dataset is already present in the table;
otherwise, it defaults to 0.</dd>
<dt><strong>type</strong></dt>
<dd>Not being used.</dd>
<dt><strong>process_start_ts</strong></dt>
<dd>The timestamp of the start of processing the dataset, generated by the
database.</dd>
<dt><strong>process_end_ts</strong></dt>
<dd>The timestamp of the completion of processing the dataset, generated by
the database. <tt class="docutils literal"><span class="pre">NULL</span></tt> if processing is ongoing.</dd>
<dt><strong>detection_threshold</strong></dt>
<dd>The detection threshold that was used by source finder to extract sources.
Value read from either the source finder parset file or the tkp.cfg file.
See the <a class="reference internal" href="../../tools/pyse.html#pyse"><em>PySE documentation</em></a> for more information.</dd>
<dt><strong>analysis_threshold</strong></dt>
<dd>The analysis threshold that was used by source finder to extract sources.
Value read from either the source finder parset file or the tkp.cfg file.
See the <a class="reference internal" href="../../tools/pyse.html#pyse"><em>PySE documentation</em></a> for more information.</dd>
<dt><strong>assoc_radius</strong></dt>
<dd>The association radius that is being used for associating sources. Value
read from either the source finder parset file or the tkp.cfg file.</dd>
<dt><strong>backsize_x</strong></dt>
<dd>Background grid segment size in x. Value read from either the source finder
parset file or the tkp.cfg file. See the <a class="reference internal" href="../../tools/pyse.html#pyse"><em>PySE documentation</em></a>
for more information.</dd>
<dt><strong>backsize_y</strong></dt>
<dd>Background grid segment size in y. Value read from either the source finder
parset file or the tkp.cfg file. See the <a class="reference internal" href="../../tools/pyse.html#pyse"><em>PySE documentation</em></a>
for more information.</dd>
<dt><strong>margin_width</strong></dt>
<dd>Margin applied to each edge of image (in pixels). Value read from either
the source finder parset file or the tkp.cfg file. See the <a class="reference internal" href="../../tools/pyse.html#pyse"><em>PySE
documentation</em></a> for more information.</dd>
<dt><strong>description</strong></dt>
<dd>A description of the dataset, with a maximum of 100 characters.</dd>
<dt><strong>node(s)</strong></dt>
<dd>Determine the current and number of nodes in case of a sharded database
set-up.</dd>
</dl>
</div>
<div class="section" id="extractedsource">
<span id="schema-extractedsource"></span><h3>extractedsource<a class="headerlink" href="#extractedsource" title="Permalink to this headline">¶</a></h3>
<p>This table contains all the extracted sources (measurements) of an image.
Maybe source is not the right description, because measurements may be made
that were erronous and do not represent a source.</p>
<p>Most values come from the sourcefinder procedures, and some are auxiliary
deduced values generated by the database.</p>
<p>This table is empty <em>before</em> an observation. <em>During</em> an observation new
sources are inserted into this table. <em>After</em> an observation this table is
dumped and transported to the catalog database.</p>
<p>All detections (measurements) found by sourcefinder are appended to this table.
At insertion time some additional auxiliary parameters are calculated by the
database as well. At anytime, no entries will be deleted or updated.
The TraP may add forced-fit entries to this table as well. Then
<tt class="docutils literal"><span class="pre">extract_type</span></tt> is set to 1.</p>
<dl class="docutils">
<dt><strong>id</strong></dt>
<dd>Every inserted source/measurement gets a unique id, generated by the
database.</dd>
<dt><strong>image</strong></dt>
<dd>The reference ID to the image from which this sources was extracted.</dd>
<dt><strong>zone</strong></dt>
<dd>The zone ID in which the source declination resides, calculated by the
database.  The sphere is devided into zones of equal width: currently fixed
to 1 degree, and the zone is effectively the truncated declination.
(decl=31.3 =&gt; zone=31, decl=31.9 =&gt; zone=31). This column is primarly for
speeding up source look-up queries.</dd>
<dt><strong>ra</strong></dt>
<dd>Right ascension of the measurement (J2000 degrees). Calculated by the
sourcefinder procedures.</dd>
<dt><strong>decl</strong></dt>
<dd>Declination of the measurement (J2000 degrees). Calculated by the
sourcefinder procedures.</dd>
<dt><strong>ra_err</strong></dt>
<dd>The 1-sigma error on <tt class="docutils literal"><span class="pre">ra</span></tt> (degrees), i.e. the square root of the
quadratic sum of the fitted error (<tt class="docutils literal"><span class="pre">ra_fit_err</span></tt>) and the systematic
error (<tt class="docutils literal"><span class="pre">ew_sys_err</span></tt>) after the latter has been corrected for ra
inflation depending on declination.  It is calculated by the database at
insertion time.  Note that this error is declination dependent and the
source lies in the range [ra - ra_err, ra + ra_err].</dd>
<dt><strong>decl_err</strong></dt>
<dd>The 1-sigma error on declination (degrees), i.e. the square root of the
quadratic sum of the fitted error (<tt class="docutils literal"><span class="pre">decl_fit_err</span></tt>) and the systematic
error (<tt class="docutils literal"><span class="pre">ns_sys_err</span></tt>), calculated by the database at insertion time.
Note that the source lies in the range [<tt class="docutils literal"><span class="pre">decl</span> <span class="pre">-</span> <span class="pre">decl_err</span></tt>, <tt class="docutils literal"><span class="pre">decl</span> <span class="pre">+</span>
<span class="pre">decl_err</span></tt>]</dd>
<dt><strong>uncertainty_ew</strong></dt>
<dd>The 1-sigma on-sky error on <tt class="docutils literal"><span class="pre">ra</span></tt> (in the east-west direction) (degrees),
ie. the square root of the quadratic sum of the error radius
(<tt class="docutils literal"><span class="pre">error_radius</span></tt>) and the systematic error (<tt class="docutils literal"><span class="pre">ew_sys_err</span></tt>).  It is
calculated by the database at insertion time.  Note that this is a
positional uncertainty and is declination independent.  This error is
being used in the De Ruiter calculations.</dd>
<dt><strong>uncertainty_ns</strong></dt>
<dd>Analogous to <tt class="docutils literal"><span class="pre">uncertainty_ew</span></tt>.</dd>
<dt><strong>ra_fit_err</strong></dt>
<dd>The 1-sigma error on <tt class="docutils literal"><span class="pre">ra</span></tt> (degrees) from the source gaussian fitting,
calculated by the sourcefinder procedures. It is important to note that a
source&#8217;s fitted ra error increases towards the poles, and is thus
declination dependent (see also <tt class="docutils literal"><span class="pre">error_radius</span></tt>).</dd>
<dt><strong>decl_fit_err</strong></dt>
<dd>The 1-sigma error from the source fitting for declination (degrees),
calculated by the sourcefinder procedures (see also <tt class="docutils literal"><span class="pre">error_radius</span></tt>).</dd>
<dt><strong>ew_sys_err</strong></dt>
<dd>The systematic error on RA (arcsec).  (As an on-sky angular uncertainty,
independent of declination.) It is a telescope dependent error and is
provided by the user in the pipeline configuation.</dd>
<dt><strong>ns_sys_err</strong></dt>
<dd>Analogous to <tt class="docutils literal"><span class="pre">ew_sys_err</span></tt>.</dd>
<dt><strong>error_radius</strong></dt>
<dd>Estimate of the absolute angular error on a source&#8217;s central position
(arcsec).  It is a pessimistic estimate, because it takes the sum of the
error along the X and Y axes.</dd>
<dt><strong>x, y, z</strong></dt>
<dd>Cartesian coordinate representation of RA and declination.</dd>
<dt><strong>racosdecl</strong></dt>
<dd>The product of RA and cosine of the declination. Helpful in source look-up
association queries where we use the De Ruiter radius as an association
parameter.</dd>
<dt><strong>margin</strong></dt>
<dd><p class="first">Used for association procedures to take into account sources that lie close
to ra=0 &amp; ra=360 meridian. <em>NOTE:</em> Not currently used.</p>
<ul class="last simple">
<li><tt class="docutils literal"><span class="pre">True</span></tt>: source is close to ra=0 meridian</li>
<li><tt class="docutils literal"><span class="pre">False</span></tt>: source is far away enough from the ra=0 meridian</li>
</ul>
</dd>
</dl>
<p><strong>det_sigma</strong></p>
<blockquote>
<div>The significance level of the detection: <span class="math">\(20 \times f_\mathrm{peak}
/ \mathrm{det_sigma}\)</span> provides the detection RMS. See <a class="reference internal" href="../../bibliography.html#spreeuw-2010"><em>Spreeuw (2010)</em></a>.</div></blockquote>
<dl class="docutils">
<dt><strong>semimajor</strong></dt>
<dd>Semi-major axis that was used for gauss fitting (arcsec), calculated by
the sourcefinder procedures.</dd>
<dt><strong>semiminor</strong></dt>
<dd>Semi-minor axis that was used for gauss fitting (arcsec), calculated by
the sourcefinder procedures.</dd>
<dt><strong>pa</strong></dt>
<dd>Position Angle that was used for gauss fitting (from north through local
east, in degrees), calculated by the sourcefinder procedures.</dd>
<dt><strong>f_peak</strong></dt>
<dd>peak flux (Jy), calculated by the sourcefinder procedures.</dd>
<dt><strong>f_peak_err</strong></dt>
<dd>1-sigma error (Jy) of <tt class="docutils literal"><span class="pre">f_peak</span></tt>, calculated by the sourcefinder
procedures.</dd>
<dt><strong>f_int</strong></dt>
<dd>integrated flux (Jy), calculated by the sourcefinder procedures.</dd>
<dt><strong>f_int_err</strong></dt>
<dd>1-sigma error (Jy) of <tt class="docutils literal"><span class="pre">f_int</span></tt>, calculated by the sourcefinder
procedures.</dd>
<dt><strong>chisq, reduced_chisq</strong></dt>
<dd>Goodness of fit metrics for fitted Gaussian profiles.
(NB. These are not yet implemented, but have been placed in the schema
in advance, to avoid extra database migrations.)</dd>
<dt><strong>extract_type</strong></dt>
<dd><p class="first">Reports how the source was extracted by sourcefinder (<a class="reference internal" href="../../bibliography.html#spreeuw-2010"><em>Spreeuw (2010)</em></a>), Currently implemented values are:</p>
<blockquote class="last">
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">0</span></tt>: blind fit</li>
<li><tt class="docutils literal"><span class="pre">1</span></tt>: forced fit to pixel</li>
<li><tt class="docutils literal"><span class="pre">2</span></tt>: manually monitored position</li>
</ul>
</div></blockquote>
</dd>
<dt><strong>fit_type</strong></dt>
<dd><p class="first">Reports what fitting type was used by sourcefinder (<a class="reference internal" href="../../bibliography.html#spreeuw-2010"><em>Spreeuw (2010)</em></a>). Currently implemented values are:</p>
<blockquote class="last">
<div><ul class="simple">
<li><tt class="docutils literal"><span class="pre">0</span></tt>: moments-based analysis</li>
<li><tt class="docutils literal"><span class="pre">1</span></tt>: Gaussian fitting</li>
</ul>
</div></blockquote>
</dd>
<dt><strong>ff_runcat</strong></dt>
<dd>Null, except when the extractedsource is a forced fit
requested due to a null-detection. In that case, it is used to link
null-detection extractions to their appropriate runningcatalog entry
via the <tt class="docutils literal"><span class="pre">assocxtrsource</span></tt> table. It will initially point to the
runningcatalog id which was null-detected, but may change back to Null later
on (after the initial association is recorded in assocxtrsource)
if the runningcatalog entry forks due to a one-to-many association.</dd>
<dt><strong>ff_monitor</strong></dt>
<dd>Null, except when the extractedsource is a forced fit requested for a
position in the <tt class="docutils literal"><span class="pre">monitor</span></tt> table. In that case, it identifies the
relevant <tt class="docutils literal"><span class="pre">monitor</span></tt> entry, and is used in the association process.</dd>
<dt><strong>node(s)</strong></dt>
<dd>Determine the current and number of nodes in case of a sharded database
set-up.</dd>
</dl>
</div>
<div class="section" id="frequencyband">
<h3>frequencyband<a class="headerlink" href="#frequencyband" title="Permalink to this headline">¶</a></h3>
<p>This table contains the frequency bands that are being used inside the
database.  Here we adopt the set of pre-defined Standard LOFAR Frequency Bands
and their bandwidths as defined for <a class="reference external" href="http://www.lofar.org/wiki/doku.php?id=msss:documentation#standard_msss-lba_frequency_bands">MSSS</a>. Included are frequency bands
outside the LOFAR bands, in order to match the external catalogue frequency
bands.  When an image is taken at an unknown band, it is added to this table
by the SQL function <tt class="docutils literal"><span class="pre">getBand()</span></tt>. To make it possible to easily compare
images with slightly different effective frequencies, new bands are
constructed by rounding the effective frequency to the nearest MHz, and
assuming a band width of 1 MHz.</p>
<dl class="docutils">
<dt><strong>id</strong></dt>
<dd>Every frequency band has its unique ID, generated by the database.</dd>
<dt><strong>freq_central</strong></dt>
<dd>The central frequency (Hz) of the defined frequency band. (Note that this is not
the effective frequency, which is stored as a property in the image table.)</dd>
<dt><strong>freq_low</strong></dt>
<dd>The low end of the frequency band (Hz).</dd>
<dt><strong>freq_high</strong></dt>
<dd>The high end of the frequency band (Hz).</dd>
</dl>
</div>
<div class="section" id="image">
<h3>image<a class="headerlink" href="#image" title="Permalink to this headline">¶</a></h3>
<p>This table contains the images that are being or were processed in the TraP.
Note that the format of the image is not stored as an image property.  An
image might be a composite of multiple images, but it is not yet defined how
the individual values for effective frequency, integration times, etc are
propagated to the columns of the <tt class="docutils literal"><span class="pre">image</span></tt> table.  The <a class="reference external" href="http://www.lofar.org/operations/lib/exe/fetch.php?media=public:documents:casa_image_for_lofar_0.03.00.pdf&gt;`_">CASA image description
for LOFAR</a> describes the structure of a LOFAR CASA Image, from which most of
the data of the <tt class="docutils literal"><span class="pre">image</span></tt> table originates.</p>
<p>An image is characterised by</p>
<ul class="simple">
<li>observation timestamp (<tt class="docutils literal"><span class="pre">taustart_ts</span></tt>);</li>
<li>integration time (<tt class="docutils literal"><span class="pre">tau</span></tt>);</li>
<li>frequency band (<tt class="docutils literal"><span class="pre">band</span></tt>);</li>
<li>Stokes parameter (<tt class="docutils literal"><span class="pre">stokes</span></tt>).</li>
</ul>
<p>A group of images that belong together (defined by user, but not specified any
further) are in the same data set (i.e. they have the same reference to
dataset).</p>
<dl class="docutils">
<dt><strong>id</strong></dt>
<dd>Every image is assigned a unique ID by the database.</dd>
<dt><strong>dataset</strong></dt>
<dd>The dataset to which the image belongs.</dd>
<dt><strong>tau</strong></dt>
<dd>The integration time of the image. This is a quick reference number
related to tau_time. Currently this is not used.</dd>
<dt><strong>band</strong></dt>
<dd>The frequency band at which the observation was carried out. Its value
refers to the ID in frequencyband, where the frequency bands are
predefined. The image&#8217;s effective frequency falls within this band. If an
image has observation frequency that is not in this table, a new entry
will be created based an the effective</dd>
<dt><strong>stokes</strong></dt>
<dd>The Stokes parameter of the observation. 1 = I, 2 = Q, 3 = U and 4 = V.
The Stokes parameter originates or is read from the CASA Main table in the
coords subsection from the <tt class="docutils literal"><span class="pre">stokesX</span></tt> record.  The char value is
converted by the database to one of the four (tiny) integers.</dd>
<dt><strong>tau_time</strong></dt>
<dd>The integration time (in seconds) of the image.  The value originates or
is read from the CASA <tt class="docutils literal"><span class="pre">LOFAR_OBSERVATION</span></tt> table by differencing the
<tt class="docutils literal"><span class="pre">OBSERVATION_END</span></tt> and <tt class="docutils literal"><span class="pre">OBSERVATION_START</span></tt> data fields.</dd>
<dt><strong>freq_eff</strong></dt>
<dd>The effective frequency (or synonymously rest frequency) (in Hz) at which
the observation was carried out.  The value originates or is read from the
CASA Main table in the coords subsection from the <tt class="docutils literal"><span class="pre">spectralX</span></tt> record and
the <tt class="docutils literal"><span class="pre">crval</span></tt> field.  Note that in the case of FITS files the header
keywords representing the effective frequency are not uniquely defined and
may differ per FITS file.</dd>
<dt><strong>freq_bw</strong></dt>
<dd>The frequency bandwidth (Hz) of the observation.  Value originates or
is read from the CASA Main table in the coords subsection from the
<tt class="docutils literal"><span class="pre">spectralX</span></tt> record and the <tt class="docutils literal"><span class="pre">cdelt</span></tt> field. N This is a required value
and when it is not available an error is thrown.</dd>
<dt><strong>taustart_ts</strong></dt>
<dd>The timestamp of the start of the observation, originating or read from
the CASA LOFAR_OBSERVATION table from the <tt class="docutils literal"><span class="pre">OBSERVATION_START</span></tt> data field.</dd>
<dt><strong>skyrgn</strong></dt>
<dd>The sky region to which the image belongs.</dd>
<dt><strong>rb_smaj</strong></dt>
<dd>The semi-major axis of the restoring beam, in degrees.  Full major axis
value originates or is read from the CASA Main table in the imageinfor
subsection from the <tt class="docutils literal"><span class="pre">restoringbeam</span></tt> record and is converted at db
insertion time.</dd>
</dl>
<p><strong>rb_smin</strong></p>
<blockquote>
<div>The semi-minor axis of the restoring beam, in degrees.  Full minor axis
value originates or is read from the CASA Main table in the imageinfor
subsection from the <tt class="docutils literal"><span class="pre">restoringbeam</span></tt> record and is converted at db
insertion time.</div></blockquote>
<dl class="docutils">
<dt><strong>rb_pa</strong></dt>
<dd>The position angle of the restoring beam (from north to east to the major
axis), in degrees.  Value originates or is read from the CASA Main table
in the imageinfor subsection from the <tt class="docutils literal"><span class="pre">restoringbeam</span></tt> record.</dd>
<dt><strong>deltax, deltay</strong></dt>
<dd>Pixel sizes along the X &amp; Y axes in degrees.</dd>
<dt><strong>fwhm_arcsec</strong></dt>
<dd>The full width half maximum of the primary beam, in arcsec. Value not yet
stored in table.</dd>
<dt><strong>fov_degrees</strong></dt>
<dd>The field of view of the image, in square degrees. Not yet stored in table.</dd>
<dt><strong>rms_qc</strong></dt>
<dd>RMS for quality-control. This is the sigma-clipped RMS value from the
central region of the image, calculated in the persistence step.</dd>
<dt><strong>rms_min, rms_max</strong></dt>
<dd>The minimum and maximum values of the estimated-RMS-map within the
source-extraction region. Used when determining if a newly-detected source
is a probable transient, or just due to deeper imaging.</dd>
<dt><strong>detection_thresh, analysis_thresh</strong></dt>
<dd>The detection and analysis thresholds (as a multiple of the local RMS value)
used in the source extraction process for this image.</dd>
<dt><strong>url</strong></dt>
<dd>The url of the physical location of the image at the time of processing.
NOTE that this needs to be updated when the image is moved.</dd>
<dt><strong>node(s)</strong></dt>
<dd>Determine the current and number of nodes in case of a sharded database
set-up.</dd>
</dl>
</div>
<div class="section" id="monitor">
<span id="schema-monitor"></span><h3>monitor<a class="headerlink" href="#monitor" title="Permalink to this headline">¶</a></h3>
<p>This table stores the user-requested monitoring positions for a dataset.</p>
<dl class="docutils">
<dt><strong>id</strong></dt>
<dd>Every position in the monitor table gets a unique id.</dd>
<dt><strong>dataset</strong></dt>
<dd>The relevant dataset ID - monitoring positions are dataset-specific.</dd>
<dt><strong>ra, decl</strong></dt>
<dd>The position coordinates (J2000 degrees).</dd>
<dt><strong>runcat</strong></dt>
<dd>Initially <tt class="docutils literal"><span class="pre">NULL</span></tt>. When a forced-fit is first made to a monitoring position,
this column is updated to point to the relevant entry in the runningcatalog.</dd>
<dt><strong>name</strong></dt>
<dd>A short descriptive name, e.g. GRB140101A or SNe150101, for more
user-friendly display of results.
This functionality is not currently implemented, but the presence of this
column allows it to be trivially implemented in future without requiring
a database migration.</dd>
</dl>
</div>
<div class="section" id="newsource">
<span id="schema-newsource"></span><h3>newsource<a class="headerlink" href="#newsource" title="Permalink to this headline">¶</a></h3>
<p>For discovering transient or variable sources, our primary tools are variability
statistics. However, a bright single-epoch source cannot sensibly be assigned
variability statistics until at least a second measurement
(possibly non-detection) has been made.</p>
<p>This table tracks new sources, in the hopes that new sources considered
sufficiently bright enough to be interesting may be flagged up immediately.</p>
<p>See <a class="reference internal" href="../tkp/database/association.html#tkp.db.associations._determine_newsource_previous_limits" title="tkp.db.associations._determine_newsource_previous_limits"><tt class="xref py py-func docutils literal"><span class="pre">tkp.db.associations._determine_newsource_previous_limits()</span></tt></a> for
details on how these values are assigned.</p>
<dl class="docutils">
<dt><strong>id</strong></dt>
<dd>Unique identifier, set by the database.</dd>
<dt><strong>runcat</strong></dt>
<dd>Reference to the associated <tt class="docutils literal"><span class="pre">runningcatalog</span></tt> entry.</dd>
<dt><strong>trigger_xtrsrc</strong></dt>
<dd>Reference to the extracted source that caused insertion of this
newsource.</dd>
<dt><strong>newsource_type</strong></dt>
<dd><p class="first">Refers to how certain we are that the newly discovered source is
really &#8220;physically new&#8221;, i.e. transient. Since we do not store fine-grained
noise-maps in the database, we must be fairly conservative in our labelling
here.</p>
<p>Type 0 sources may be a steady source located in a high-RMS region,
newly detected due to noise fluctuations, or may be a real
transient in a low-RMS region.</p>
<p class="last">Type 1 sources are bright enough that we can be fairly certain
they are really new - they are significantly brighter than the <tt class="docutils literal"><span class="pre">rms_max</span></tt>
in the previous image with best detection limits.</p>
</dd>
<dt><strong>previous_limits_image</strong></dt>
<dd>The ID of the previous image with the best upper limits on previous
detections of this source. Can be used to calculate the significance
level of the new-source detection.</dd>
</dl>
</div>
<div class="section" id="node">
<h3>node<a class="headerlink" href="#node" title="Permalink to this headline">¶</a></h3>
<p>This table keeps track of zones (declinations) of the stored sources on the
nodes in a sharded database configuration. Every node in such a set-up will
have this table, but with different content.</p>
<dl class="docutils">
<dt><strong>node</strong></dt>
<dd>The ID of the node</dd>
<dt><strong>zone</strong></dt>
<dd>The zone that is available on the node</dd>
<dt><strong>zone_min</strong></dt>
<dd>The minimum zone of the zones</dd>
<dt><strong>zone_max</strong></dt>
<dd>The maximum zone of the zones</dd>
<dt><strong>zone_min_incl</strong></dt>
<dd>Boolean determining whether the minimum zone is included.</dd>
<dt><strong>zone_max_incl</strong></dt>
<dd>Boolean determining whether the maximum zone is included.</dd>
<dt><strong>zoneheight</strong></dt>
<dd>The zone height of a zone, in degrees</dd>
<dt><strong>nodes</strong></dt>
<dd>The total number of nodes in the sharded database configuration.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The following sections on the <tt class="docutils literal"><span class="pre">runningcatalog</span></tt>, <tt class="docutils literal"><span class="pre">runningcatalog_flux</span></tt> and
<tt class="docutils literal"><span class="pre">temprunningcatalog_flux</span></tt> are annotated using the style of mathematical
notations developed in the <a class="reference internal" href="#schema-appendices"><em>Appendix</em></a>.</p>
</div>
</div>
<div class="section" id="rejection">
<h3>rejection<a class="headerlink" href="#rejection" title="Permalink to this headline">¶</a></h3>
<p>This table contains all rejected images and a reference to the reason.</p>
<dl class="docutils">
<dt><strong>id</strong></dt>
<dd>The database ID of the rejection.</dd>
<dt><strong>image</strong></dt>
<dd>A foreign key relationship to the image ID of the rejected image.</dd>
<dt><strong>rejectreason</strong></dt>
<dd>A foreign key relationship to the ID of the rejection reason.</dd>
<dt><strong>comment</strong></dt>
<dd>A textfield with more details about the reason for rejection. For example
in the case of a rejection because of RMS value to high, this field will
contain the theoretical noise value and the calculated RMS value of the
image.</dd>
</dl>
</div>
<div class="section" id="rejectreason">
<h3>rejectreason<a class="headerlink" href="#rejectreason" title="Permalink to this headline">¶</a></h3>
<p>This table contains all the possible reasons for rejecting an image.</p>
<dl class="docutils">
<dt><strong>id</strong></dt>
<dd>The database ID of the rejection reason.</dd>
<dt><strong>description</strong></dt>
<dd>An description of the rejection.</dd>
</dl>
</div>
<div class="section" id="runningcatalog">
<span id="schema-runningcatalog"></span><h3>runningcatalog<a class="headerlink" href="#runningcatalog" title="Permalink to this headline">¶</a></h3>
<p>(See <a class="reference internal" href="#schema-appendices"><em>Appendices</em></a> for explanation of mathematical notation.)</p>
<p>While a single entry in <tt class="docutils literal"><span class="pre">extractedsource</span></tt> corresponds to an individual
source measurement, a single entry in <tt class="docutils literal"><span class="pre">runningcatalog</span></tt> corresponds to a
unique astronomical source detected in a specific dataset (series of images).
The position of this unique source is a weighted mean of all its individual
source measurements.  The relation between a <tt class="docutils literal"><span class="pre">runningcatalog</span></tt> source and all
its measurements in <tt class="docutils literal"><span class="pre">extractedsource</span></tt> is maintained in <tt class="docutils literal"><span class="pre">assocxtrsource</span></tt>.</p>
<p>The association procedure matches extracted sources with counterpart
candidates in the runningcatalog table.  Depending on their association
parameters (distance and De Ruiter radius) of the <tt class="docutils literal"><span class="pre">runningcatalog</span></tt> source
and <tt class="docutils literal"><span class="pre">extractedsource</span></tt> source, the source pair ids are added to
<tt class="docutils literal"><span class="pre">assocxtrsource</span></tt>.  The source properties, position, fluxes and their errors
in the <tt class="docutils literal"><span class="pre">runningcatalog</span></tt> and <tt class="docutils literal"><span class="pre">runningcatalog_flux</span></tt> tables are then updated
to include the counterpart values from the extracted source as a new
datapoint.</p>
<p>If no counterpart could be found for an extracted sources, it is appended to
<tt class="docutils literal"><span class="pre">runningcatalog</span></tt> as a &#8220;new&#8221; source (datapoint=1).</p>
<dl class="docutils">
<dt><strong>id</strong></dt>
<dd>Every source in the running catalog gets a unique ID.</dd>
<dt><strong>xtrsrc</strong></dt>
<dd>The ID of the extractedsource for which this runningcatalog source was
detected for the first time.</dd>
<dt><strong>dataset</strong></dt>
<dd>The dataset to which the runningcatalog source belongs to.</dd>
<dt><strong>datapoints</strong> <span class="math">\(= N_\alpha\)</span> or equivalently <span class="math">\(N_\delta\)</span></dt>
<dd>The number of datapoints (or number of times this source was detected)
that is included in the calculation of the <em>position</em> averages.  It is
assumed that a source&#8217;s position stays relatively constant across bands
and therefore all bands are included in averaging the position.</dd>
<dt><strong>zone</strong></dt>
<dd>The zone ID in which the source declination resides.  The sphere is divided
into zones of equal width: here fixed to 1 degree, and the zone is
effectively the truncated declination. (decl=31.3 =&gt; zone=31, decl=31.9 =&gt;
zone=31)</dd>
<dt><strong>wm_ra</strong> <span class="math">\(= \xi_{\alpha}\)</span></dt>
<dd>The weighted mean of RA of the source [in J2000 degrees].</dd>
<dt><strong>wm_decl</strong> <span class="math">\(=\xi_{\delta}\)</span></dt>
<dd>The weighted mean of Declination of the source [in J2000 degrees].</dd>
<dt><strong>wm_uncertainty_ew</strong></dt>
<dd>The positional on-sky uncertainty in the east-west direction of the
weighted mean RA (degrees).</dd>
<dt><strong>wm_uncertainty_ns</strong></dt>
<dd>The positional on-sky uncertainty in the north-south direction of the
weighted mean Dec (degrees).</dd>
<dt><strong>avg_ra_err</strong></dt>
<dd>The average of the <tt class="docutils literal"><span class="pre">ra_err</span></tt> of the source (degrees).</dd>
<dt><strong>avg_decl_err</strong></dt>
<dd>The average of the <tt class="docutils literal"><span class="pre">decl_err</span></tt> of the source (degrees).</dd>
<dt><strong>avg_wra</strong> <span class="math">\(=\overline{w_{\alpha}\alpha}\)</span></dt>
<dd>The average of (the square of <tt class="docutils literal"><span class="pre">ra/uncertainty_ew</span></tt>). Used for calculating the
weighted mean of the RA.</dd>
<dt><strong>avg_wdecl</strong> <span class="math">\(=\overline{w_{\delta}\delta}\)</span></dt>
<dd>Analogous to <tt class="docutils literal"><span class="pre">avg_wra</span></tt>.</dd>
<dt><strong>avg_weight_ra</strong> <span class="math">\(=\overline{w_{\alpha}}\)</span></dt>
<dd>The average of the reciprocal of the square of <tt class="docutils literal"><span class="pre">uncertainty_eq</span></tt>. Used
for calculating the weighted mean of the RA.</dd>
<dt><strong>avg_weight_decl</strong>   <span class="math">\(=\overline{w_{\delta}}\)</span></dt>
<dd>Analogous to <tt class="docutils literal"><span class="pre">avg_weight_ra</span></tt>.</dd>
<dt><strong>x, y, z</strong></dt>
<dd>The Cartesian coordinate representation of <tt class="docutils literal"><span class="pre">wm_ra</span></tt> and <tt class="docutils literal"><span class="pre">wm_decl</span></tt>.</dd>
<dt><strong>inactive</strong></dt>
<dd>Boolean to set an entry to inactive.  This is done during the <a class="reference internal" href="assoc.html#database-assoc"><em>source
association</em></a> procedure, where e.g. the many-to-many cases
are handled and an existing entry is replaced by two or more entries.</dd>
<dt><strong>mon_src</strong></dt>
<dd>Boolean to indicate whether an entry is from the user-specified monitoring list.
Default value is false.</dd>
</dl>
</div>
<div class="section" id="runningcatalog-flux">
<span id="schema-runningcatalog-flux"></span><h3>runningcatalog_flux<a class="headerlink" href="#runningcatalog-flux" title="Permalink to this headline">¶</a></h3>
<p>The runningcatalog_flux table contains the averaged flux measurements of a
runningcatalog source, per band and stokes parameter. The combination runcat,
band and stokes is the primary key.</p>
<p>The flux squared and weights are used for calculations of the variability
indices, <span class="math">\(V_\nu\)</span> and <span class="math">\(\eta_\nu\)</span>.</p>
<dl class="docutils">
<dt><strong>runcat</strong></dt>
<dd>The <tt class="docutils literal"><span class="pre">id</span></tt> of the <tt class="docutils literal"><span class="pre">runningcatalog</span></tt> entry to which this band/stokes/flux
belongs.</dd>
<dt><strong>band</strong></dt>
<dd>Reference to the frequency band of this flux.</dd>
<dt><strong>stokes</strong></dt>
<dd>Stokes parameter: 1 = I, 2 = Q, 3 = U, 4 = V.</dd>
<dt><strong>f_datapoints</strong>   <span class="math">\(=N_I\)</span></dt>
<dd>The number of <em>flux</em> datapoints for which the flux averages were calculated.</dd>
<dt><strong>avg_f_peak</strong>  <span class="math">\(=\overline{I}\)</span></dt>
<dd>Average of peak flux.</dd>
<dt><strong>avg_f_peak_sq</strong>  <span class="math">\(=\overline{{I}^2}\)</span></dt>
<dd>Average of (peak flux squared).</dd>
<dt><strong>avg_f_peak_weight</strong>  <span class="math">\(=\overline{w_{I}}\)</span></dt>
<dd>Average of one over peak flux errors squared.</dd>
<dt><strong>avg_weighted_f_peak</strong> <span class="math">\(=\overline{w_{I} I}\)</span></dt>
<dd>Average of ratio of (peak flux) and (peak flux errors squared).</dd>
<dt><strong>avg_weighted_f_peak_sq</strong> <span class="math">\(=\overline{w_{I} I^2}\)</span></dt>
<dd>Average of (weighted peak flux squared).</dd>
<dt><strong>avg_f_int, avg_f_int_sq, avg_f_int_weight, avg_weighted_f_int, avg_weighted_f_int_sq</strong></dt>
<dd>Analogous to those above, except for the <em>integrated</em> flux.</dd>
</dl>
</div>
<div class="section" id="skyregion">
<span id="schema-skyregion"></span><h3>skyregion<a class="headerlink" href="#skyregion" title="Permalink to this headline">¶</a></h3>
<p>Entries in this table represent regions of sky which have been, or will
shortly be, processed via the usual extract-sources-and-associate procedures.
By listing regions of sky in a dedicated table, we de-duplicate information
that would otherwise be repeated for many images.</p>
<p>When an image is first inserted into the database, the SQL function
<tt class="docutils literal"><span class="pre">getSkyRgn</span></tt> is called. This first checks for the pre-existence of a matching
skyregion entry. If none exists, then a new entry is created and the SQL
function <tt class="docutils literal"><span class="pre">updateSkyRgnMembers</span></tt> is called to update the <a class="reference internal" href="#schema-assocskyrgn"><em>assocskyrgn</em></a> table as necessary.</p>
<p>See also <a class="reference internal" href="#schema-assocskyrgn"><em>assocskyrgn</em></a>.</p>
<dl class="docutils">
<dt><strong>dataset</strong></dt>
<dd>Reference to the <tt class="docutils literal"><span class="pre">dataset</span></tt> <tt class="docutils literal"><span class="pre">id</span></tt>, for the dataset to which the skyregion
belongs. This field is needed in order to restrict association to the
current dataset.</dd>
<dt><strong>centre_ra</strong> and <strong>centre_decl</strong></dt>
<dd>The central coordinates (J2000) (or pointing centre) of the region, in
degrees.  RA and Dec values are read from <tt class="docutils literal"><span class="pre">DataAccessor</span></tt> metadata.</dd>
<dt><strong>xtr_radius</strong></dt>
<dd>The radius of the circular mask used for source extraction, in degrees.
This is calculated from the <tt class="docutils literal"><span class="pre">extraction_radius_pix</span></tt> parameter and the
image metadata during the <a class="reference internal" href="../../userref/structure/stages/persistence.html#stage-persistence"><em>persistence pipeline stage</em></a>.</dd>
<dt><strong>x</strong>, <strong>y</strong> and <strong>z</strong></dt>
<dd>The Cartesian coordinates of <tt class="docutils literal"><span class="pre">centre_ra</span></tt> and <tt class="docutils literal"><span class="pre">centre_decl</span></tt>.</dd>
</dl>
</div>
<div class="section" id="temprunningcatalog">
<span id="schema-temprunningcatalog"></span><h3>temprunningcatalog<a class="headerlink" href="#temprunningcatalog" title="Permalink to this headline">¶</a></h3>
<p>(See also <a class="reference internal" href="assoc.html#database-assoc-details"><em>source association detailed logic</em></a>.)</p>
<p>Most of the entries in the <tt class="docutils literal"><span class="pre">temprunningcatalog</span></tt> are identical to those of
the same name in <a class="reference internal" href="#schema-runningcatalog"><em>runningcatalog</em></a> and
<a class="reference internal" href="#schema-runningcatalog-flux"><em>runningcatalog_flux</em></a>, except updated to include the information
from a new <tt class="docutils literal"><span class="pre">extractedsource</span></tt>.  Those without direct counterparts in those
tables are listed below.</p>
<dl class="docutils">
<dt><strong>runcat</strong></dt>
<dd>Reference to the <tt class="docutils literal"><span class="pre">runningcatalog</span></tt> <tt class="docutils literal"><span class="pre">id</span></tt>. <tt class="docutils literal"><span class="pre">runcat</span></tt> and <tt class="docutils literal"><span class="pre">xtrsrc</span></tt>
together form a unique key.</dd>
<dt><strong>xtrsrc</strong></dt>
<dd>Reference to the <tt class="docutils literal"><span class="pre">extractedsource</span></tt> <tt class="docutils literal"><span class="pre">id</span></tt>. <tt class="docutils literal"><span class="pre">runcat</span></tt> and <tt class="docutils literal"><span class="pre">xtrsrc</span></tt>
together form a unique combination.</dd>
<dt><strong>distance_arcsec</strong></dt>
<dd>The distance in arcsec on the sky of the <tt class="docutils literal"><span class="pre">runcat</span></tt> - <tt class="docutils literal"><span class="pre">xtrsrc</span></tt>
association, as calculated by the database.</dd>
<dt><strong>r</strong></dt>
<dd>The De Ruiter radius of the <tt class="docutils literal"><span class="pre">runcat</span></tt> - <tt class="docutils literal"><span class="pre">xtrsrc</span></tt> association,
calculated by the database.</dd>
<dt><strong>inactive</strong></dt>
<dd>During evaluation of the association pairs, some pairs might be set to
inactive (<tt class="docutils literal"><span class="pre">TRUE</span></tt>), defaults to <tt class="docutils literal"><span class="pre">FALSE</span></tt>.</dd>
<dt><strong>beam_semimaj, beam_semimin, beam_pa</strong></dt>
<dd>Not currently used.</dd>
</dl>
</div>
<div class="section" id="version">
<h3>version<a class="headerlink" href="#version" title="Permalink to this headline">¶</a></h3>
<p>This table contains the current schema version of the database. Every schema
upgrade will increment the value by 1.</p>
<dl class="docutils">
<dt><strong>name</strong></dt>
<dd>The name of the version.</dd>
<dt><strong>value</strong></dt>
<dd>The version number, which increments after every database change.</dd>
</dl>
</div>
</div>
<div class="section" id="appendices">
<span id="schema-appendices"></span><h2>Appendices<a class="headerlink" href="#appendices" title="Permalink to this headline">¶</a></h2>
<div class="section" id="on-iteratively-updated-weighted-means">
<h3>On iteratively updated weighted means<a class="headerlink" href="#on-iteratively-updated-weighted-means" title="Permalink to this headline">¶</a></h3>
<p>We now take a diversion to note the mechanics of storing and updating weighted
means - this happens a lot in the database.</p>
<p>We define the average (specifically, the <em>arithmetic mean</em>) of <span class="math">\(x\)</span> as</p>
<div class="math">
\[\overline{x}_N = \frac{1}{N} \sum_{i=1}^{N} x_i\]</div>
<p>where <span class="math">\(x_i\)</span> is the <span class="math">\(i\)</span> th measurement of <span class="math">\(x\)</span>.</p>
<p>We may update this in an iterative fashion.
If we add the next datapoint, <span class="math">\(x_{N+1}\)</span>, to it, we can build the
new average as:</p>
<div class="math" id="equation-simple_mean_update">
<span class="eqno">(1)</span>\[\overline{x}_{N+1} = \frac{N \overline{x}_N + x_{N+1}}{N+1} .\]</div>
<p>We now treat weighted means.</p>
<p>We first define the weight of the <span class="math">\(i\)</span> th measurement of x,</p>
<div class="math">
\[w_{x_i} = 1/{e_{x_i}}^2\]</div>
<p>where <span class="math">\(e_{x_i}\)</span> is the one-sigma error in the <span class="math">\(i\)</span> th measurement
of x.</p>
<p>We can now define a weighted mean of N measurements of <span class="math">\(x\)</span>;
<span class="math">\(\xi_{x_N}\)</span> as:</p>
<div class="math">
\[\xi_{x_N} = \frac{\sum_{i=1}^{N} w_{x_i} x_i}{\sum_{i=1}^{N} w_{x_i}}.\]</div>
<p>To update this weighted average,
we first define the sum of the weights as</p>
<div class="math">
\[W_{x_N} = \sum_{i=1}^{N} w_{x_i}\]</div>
<p>we may then calculate the  weighted average after N+1 measurements as:</p>
<div class="math" id="equation-wt_mean_update_1">
<span class="eqno">(2)</span>\[\xi_{x_{N+1}} =   \frac{ W_{x_N} \xi_{{x_N}} + w_{{x_{N+1}}}x_{N+1}}
                              { W_{x_N} + w_{x_{N+1}} }\]</div>
<p>Note, if we define the mean or &#8216;bar&#8217; operator such that:</p>
<div class="math">
\[\overline{y}_{N} = \frac{\sum_{i=1}^{N} y_i}{N}\]</div>
<p>for any variable <span class="math">\(y\)</span>, then</p>
<div class="math">
\[\overline{w}_{x_N} = \frac{\sum_{i=1}^{N} w_{x_i}}{N} = \frac{W_{x_N}}{N}\]</div>
<p>and we may use the formula:</p>
<div class="math" id="equation-wt_mean_update_2">
<span class="eqno">(3)</span>\[\xi_{x_{N+1}} =
 \frac{ N \overline{w}_{x_N} \xi_{x_N} + w_{x_{N+1}}x_{N+1}}
      { N \overline{w}_{x_N} + w_{x_{N+1}} }\]</div>
<p>(Note how this simplifies if <span class="math">\(w_i = 1 \quad \forall i\)</span>)</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>For tracking Ra and Dec  (<span class="math">\(\alpha\)</span> and <span class="math">\(\delta\)</span>) weighted
means, we substitute</p>
<div class="math">
\[N \overline{ w_{\alpha_N} } \xi_{\alpha_N} =
N \overline{ (w_{\alpha} \alpha )_N}\]</div>
<p>to yield another manipulation of the update formula:</p>
<div class="math" id="equation-wt_mean_update_3">
<span class="eqno">(4)</span>\[\xi_{\alpha_{N+1}} =
 \frac{ N \overline{ (w_{\alpha} \alpha )_N} + w_{\alpha_{N+1}}\alpha_{N+1}}
      { N \overline{w}_{\alpha_N} + w_{\alpha_{N+1}} }\]</div>
<p class="last"><strong>Note that this requires that we also keep track of the extra aggregate
value:</strong> <span class="math">\(\overline{ (w_{\alpha} \alpha )_N}\)</span>, which is probably
unnecessary given that we are not performing reduced-<span class="math">\(\chi^2\)</span> stats
on the position.</p>
</div>
<p>In general, we perform similar tricks with aggregate values (i.e. storing the
&#8216;barred&#8217; values of variables) throughout the database code. This has pros and
cons - it makes the equations below a little prettier (and possibly simpler to
compute), but requires many multiplications and divisions by the factor
<span class="math">\(N\)</span> (hence, also possibly harder to compute - this may be worth careful
consideration during the next big code review).</p>
</div>
<div class="section" id="on-aggregated-variability-indexes">
<h3>On &#8216;aggregated&#8217; variability indexes<a class="headerlink" href="#on-aggregated-variability-indexes" title="Permalink to this headline">¶</a></h3>
<p>We now explain how running averages are used to compute the &#8216;variability indices&#8217;
we use in identifying sources which may be intrinsically transient or variable.
Adapted from <a class="reference internal" href="../../bibliography.html#scheers-2011"><em>Scheers (2011)</em></a>.</p>
<p>The first variability indicator, the proportional flux variability of a
source, is expressed as the ratio of the sample standard deviation, and mean,
of the flux <span class="math">\(I\)</span>; that is to say:</p>
<div class="math">
\[V = \frac{ s}{ \overline{I} }\]</div>
<p>where <span class="math">\(s\)</span> is the unbiased sample standard deviation:</p>
<div class="math">
\[s = \sqrt{ \frac{1}{N-1} \sum_{i=1}^N \left( I_i - \overline{I}  \right)^2 }\]</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In general, we may consider calculating all these values per frequency-band
and subscript them by band central frequency <span class="math">\(\nu\)</span>, but we neglect such
details here for simplicity.</p>
</div>
<p>Written in its well known &#8216;aggregate&#8217; form, it is now easy to handle bulk
data, and is defined as</p>
<div class="math">
\[V = \frac{1}{\overline{I}}
          \sqrt{ \frac{N}{N-1}
                    \left( \overline{{I}^2} - \overline{I}^2  \right)
               }\]</div>
<p>The second indicator, the significance of the flux variability, is based on
reduced <span class="math">\(\chi^2\)</span> statistics. We derive the aggregate form here.</p>
<p>We begin with the familiar reduced-<span class="math">\(\chi^2\)</span> formula, except with the
regular arithmetic mean <span class="math">\(\overline{I}\)</span> replaced by the
weighted mean <span class="math">\(\xi_{I_N}\)</span>,</p>
<div class="math">
\[\xi_{I_N} = \frac{\sum_{i=1}^{N} w_i I_i}{\sum_{i=1}^{N} w_i}
      = \frac{\overline{w_i I_i} }{ \overline{w_i}},\]</div>
<p>resulting in:</p>
<div class="math">
\[\eta = \frac{1}{N-1}
              \sum_{i=1}^N
                 \frac{\left(I_i - \xi_{I_N} \right)^2}
                     {e_i^2}\]</div>
<p>where <span class="math">\(e_i\)</span> is the estimated uncertainty, or standard deviation,
in <span class="math">\(I_i\)</span>.  We may rewrite this using <span class="math">\(\frac{1}{e_i^2} = w_i\)</span>:</p>
<div class="math">
\[\eta = \frac{N}{N-1}\lgroup \frac{1}{N}
              \sum_{i=1}^N w_i \left(I_i - \xi_{I_N} \right)^2 \rgroup\]</div>
<p>Expanding inside the brackets gives:</p>
<div class="math">
\[\frac{1}{N}\sum_{i=1}^N
   w_i \left( I_i^2 - 2\xi_{I_N} I_i + \xi_{I_N}^2 \right)\]\[ = \frac{1}{N} \sum_{i=1}^N w_i I_i^2
   - 2\xi_{I_N} \frac{1}{N}\sum_{i=1}^N w_i I_i
   + \xi_{I_N}^2 \frac{1}{N}\sum_{i=1}^N w_i\]\[= \overline{w_i I_i^2} - 2\xi_{I_N} \overline{w_i I_i} +\xi_{I_N}^2 \overline{w_i}
   \qquad .\]</div>
<p>Expanding for <span class="math">\(\xi_{I_N}\)</span> results in the final aggregate form of
the reduced-<span class="math">\(\chi^2\)</span>:</p>
<div class="math">
\[\eta = \frac{N}{N-1}
             \left(
                \overline{w {I}^2}
                -
                \frac{\overline{w I}^2}{\overline{w}}
             \right)\]</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/lofar.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Schema reference</a><ul>
<li><a class="reference internal" href="#table-listing">Table Listing</a><ul>
<li><a class="reference internal" href="#assocxtrsource">assocxtrsource</a></li>
<li><a class="reference internal" href="#assocskyrgn">assocskyrgn</a></li>
<li><a class="reference internal" href="#config">config</a></li>
<li><a class="reference internal" href="#dataset">dataset</a></li>
<li><a class="reference internal" href="#extractedsource">extractedsource</a></li>
<li><a class="reference internal" href="#frequencyband">frequencyband</a></li>
<li><a class="reference internal" href="#image">image</a></li>
<li><a class="reference internal" href="#monitor">monitor</a></li>
<li><a class="reference internal" href="#newsource">newsource</a></li>
<li><a class="reference internal" href="#node">node</a></li>
<li><a class="reference internal" href="#rejection">rejection</a></li>
<li><a class="reference internal" href="#rejectreason">rejectreason</a></li>
<li><a class="reference internal" href="#runningcatalog">runningcatalog</a></li>
<li><a class="reference internal" href="#runningcatalog-flux">runningcatalog_flux</a></li>
<li><a class="reference internal" href="#skyregion">skyregion</a></li>
<li><a class="reference internal" href="#temprunningcatalog">temprunningcatalog</a></li>
<li><a class="reference internal" href="#version">version</a></li>
</ul>
</li>
<li><a class="reference internal" href="#appendices">Appendices</a><ul>
<li><a class="reference internal" href="#on-iteratively-updated-weighted-means">On iteratively updated weighted means</a></li>
<li><a class="reference internal" href="#on-aggregated-variability-indexes">On &#8216;aggregated&#8217; variability indexes</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">The Pipeline Database</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="assoc.html"
                        title="next chapter">Source Association Logic</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/devref/database/schema.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="assoc.html" title="Source Association Logic"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="The Pipeline Database"
             >previous</a> |</li>
        <li><a href="../../index.html">LOFAR Transients Pipeline 2.0.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Developer&#8217;s Reference Guide</a> &raquo;</li>
          <li><a href="index.html" >The Pipeline Database</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2006—2015, LOFAR Transients Key Science Project.
    </div>
  </body>
</html>