<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Database &mdash; LOFAR Transients Pipeline 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../_static/lofar.ico"/>
    <link rel="top" title="LOFAR Transients Pipeline 1.0 documentation" href="../../index.html" />
    <link rel="up" title="The TKP Database" href="index.html" />
    <link rel="next" title="Schema" href="schema.html" />
    <link rel="prev" title="The TKP Database" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="schema.html" title="Schema"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="The TKP Database"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">LOFAR Transients Pipeline 1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Developer&#8217;s Reference Guide</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">The TKP Database</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="database">
<span id="database-section"></span><h1>Database<a class="headerlink" href="#database" title="Permalink to this headline">¶</a></h1>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The information on this page is old and, in places, outdated.</p>
</div>
<p>This section concerns the (MonetDB) database that is used to store
extracted sources and determine variable sources. In addition, it
stores catalogs from previous surveys, which can be used for creating
a sky model for BBS, and it stores some characteristics of
(classified) transient sources. It does not deal with the PostgreSQL
database used by BBS.</p>
<p>The default scratch database, both on heastro1 and CEP, is simply
called tkp; the login and password are both tkp as well. On heastro1,
the database server is heastro1 or localhost, on CEP ldb001.</p>
<div class="section" id="interactive-login">
<h2>Interactive login<a class="headerlink" href="#interactive-login" title="Permalink to this headline">¶</a></h2>
<p>You can login to the scratch database using the :command`mclient` command
(on lhn001, best is probably to use a locally build version, eg
<strong class="command">/home/rol/.local/bin/mclient</strong>. On heastro1,
it&#8217;s <strong class="command">/opt/monetdb/bin/mclient</strong>).</p>
<p>This allows you to manually inspect the data that is stored in the
database, which is sometimes useful for debugging purposes.</p>
<p>You will need a <tt class="file docutils literal"><span class="pre">$HOME/.monetdb</span></tt> file that contains the login
details (user and password). The following should work:</p>
<div class="highlight-python"><div class="highlight"><pre>$&gt; cat &gt; ~/.monetdb &lt;&lt;EOF
user=tkp
password=tkp
EOF
$&gt; mclient -dtkp [-hldb001]
Welcome to mclient, the MonetDB/SQL interactive terminal
Database: MonetDB v5.18.4, &#39;tkp&#39;
Type \q to quit, \? for a list of available commands
auto commit mode: on
sql&gt;
</pre></div>
</div>
<p>The <em class="xref std std-option">-h</em> host option is only necessary if you are connecting to
a database running on a different machine than the one you are currently logged
in to.</p>
<p>If you do not want to create a <tt class="file docutils literal"><span class="pre">.monetdb</span></tt> file or want to (temporarily)
access another database, simply use the <em class="xref std std-option">-u</em> option to use
a different login; the password will be asked interactively.</p>
<p>If you have your own MonetDB database, you may occasionaly need to update the
tables to the current definition. These table and function definitions
are stored in the TKP daily build directory, in the database
subdirectory. You probably first want to create a dump of any contents
you&#8217;d like to save (using the <strong class="command">sql&gt;\D</strong> command on the
<tt class="docutils literal"><span class="pre">sql&gt;</span></tt> prompt; see <strong class="command">sql&gt;\?</strong>). After that, remove all tables
(<strong class="command">sql&gt;drop table &lt;name&gt; cascade;</strong>. Do this for all tables)
and possibly even functions (you can get an overview of the latter
using <strong class="command">sql&gt;select name from sys.functions where mod =
&#8216;user&#8217;;</strong>).</p>
<p>Then, cd into the daily build <tt class="file docutils literal"><span class="pre">database/batches</span></tt>
directory(<tt class="file docutils literal"><span class="pre">/opt/tkp/tkp/database/batches</span></tt> on heastro1 and
<tt class="file docutils literal"><span class="pre">/home/rol/tkp/tkp/database/batches</span></tt> on lfe001), and run:</p>
<div class="highlight-python"><div class="highlight"><pre>$&gt; ./setup.db.batch --no-create-database ldb001 &lt;dbname&gt;
</pre></div>
</div>
<p>(Again, this requires a correct <tt class="file docutils literal"><span class="pre">~/.monetdb</span></tt> file.)
The <em class="xref std std-option">--no-create-database</em> will prevent the script from completely
deleting and recreating the database, and instead it will just create
the necessary tables and functions. It will also load various catalogs
(NVSS, WENSS, VLSS); this may take a while, so if the script seems to
pause for a while, it is probably loading those catalogs.</p>
<p>You can check if everything went correct (assuming you didn&#8217;t see any
errors in the output from the setup.db.batch script in the first
place) by logging in to your database (<strong class="command">$&gt; mclient -lsql -d&lt;dbname&gt;
-h&lt;dbhost&gt;</strong>. Then execute the following commands:</p>
<div class="highlight-python"><div class="highlight"><pre>sql&gt; select * from versions;

sql&gt; select * from catalogs;

sql&gt; select count(*) from catalogedsources;
</pre></div>
</div>
<p>The first command should show a creation date of today. The second
command will tell you which catalogs have been loaded (currently,
March 2011, there are four, since the WENSS comes in two parts). The
third command will tell you how many catalog sources there are (March
2011, 2071205 sources).</p>
<p>Finally, for the latest-greatest and possibly unstable version of the database
setup, use <cite>tkpdev</cite> instead of <cite>tkp</cite>. This database gets wiped every night and
not backed-up though, so do not store anything valuable in it.</p>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>If there is no working database on your system, you will have to install
MonetDB yourself. Grab the most recent (stable) release from www.monetdb.org,
then install in the usual way:</p>
<div class="highlight-python"><div class="highlight"><pre>$&gt; ./configure
$&gt; make
($&gt; make check)
$&gt; (sudo) make install
</pre></div>
</div>
<p>Make sure the installation <cite>bin</cite> directory is in your path, then start up the
database server:</p>
<div class="highlight-python"><div class="highlight"><pre>$&gt; monetdbd start
</pre></div>
</div>
<p>(notice the extra &#8216;d&#8217; at the end: monetdb daemon.)</p>
<p>This will start one or more <cite>mserver5</cite> processes that take care of connections
to the database; the number of <cite>mserver5</cite> processes is dependent on the number
of databases in use.</p>
<p>You can have the databases stored in a different place than your default installation. This is convenient when you upgrade to newer MonetDB version; you can then still use the databases from the previous version. You have to point <cite>monetdbd</cite> to your so-called database farm. For example:</p>
<div class="highlight-python"><div class="highlight"><pre>$&gt; monetdbd start /opt/dbfarm
</pre></div>
</div>
<p>You can check the status of any databases on your system:</p>
<div class="highlight-python"><div class="highlight"><pre>$&gt; monetdb status
</pre></div>
</div>
<p>(Note: if you are using a non-default database farm location, as mentioned above, you don&#8217;t need to give the path to the <cite>monetdb</cite> executable: it will normally find the correct <cite>mserver</cite> process.</p>
<p>You can easily create and then start a database:</p>
<div class="highlight-python"><div class="highlight"><pre>$&gt; monetdb create &lt;name&gt;
$&gt; monetdb release &lt;name&gt;
$&gt; monetdb start &lt;name&gt;
</pre></div>
</div>
<p>Normally, the setup script in the <cite>batches/</cite> subdirectory of the database
directory will create the database automatically for you.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/lofar.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Database</a><ul>
<li><a class="reference internal" href="#interactive-login">Interactive login</a></li>
<li><a class="reference internal" href="#installation">Installation</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">The TKP Database</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="schema.html"
                        title="next chapter">Schema</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/devref/database/intro.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="schema.html" title="Schema"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="The TKP Database"
             >previous</a> |</li>
        <li><a href="../../index.html">LOFAR Transients Pipeline 1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Developer&#8217;s Reference Guide</a> &raquo;</li>
          <li><a href="index.html" >The TKP Database</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, LOFAR Transients Key Project.
    </div>
  </body>
</html>