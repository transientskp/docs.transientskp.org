<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>tkp.sourcefinder.image – Image class &amp; routines &mdash; LOFAR Transients Pipeline 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../../_static/lofar.ico"/>
    <link rel="top" title="LOFAR Transients Pipeline 1.0 documentation" href="../../../index.html" />
    <link rel="up" title="Sourcefinder package" href="index.html" />
    <link rel="next" title="tkp.sourcefinder.extract – Source extraction routines" href="extract.html" />
    <link rel="prev" title="Introduction" href="introduction.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="extract.html" title="tkp.sourcefinder.extract – Source extraction routines"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="introduction.html" title="Introduction"
             accesskey="P">previous</a> |</li>
        <li><a href="../../../index.html">LOFAR Transients Pipeline 1.0 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Developer&#8217;s Reference Guide</a> &raquo;</li>
          <li><a href="../index.html" >Library &amp; API</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Sourcefinder package</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="tkp-sourcefinder-image-image-class-routines">
<span id="sourcefinder-image"></span><h1><a class="reference internal" href="#module-tkp.sourcefinder.image" title="tkp.sourcefinder.image: Sourcefinder Image class and routines for simple image handling"><tt class="xref py py-mod docutils literal"><span class="pre">tkp.sourcefinder.image</span></tt></a> &#8211; Image class &amp; routines<a class="headerlink" href="#tkp-sourcefinder-image-image-class-routines" title="Permalink to this headline">¶</a></h1>
<p>This module provides simple access to an image, without database
overhead. The Image class handles the actual data (a (2D) numpy
array), the world coordinate system (a tkp.utility.coordinates.WCS
instance) and the beam information. While these three objects are
supplied upon instantiation of an Image, one can use a
<tt class="xref py py-class docutils literal"><span class="pre">tkp.accessors.DataAccessor</span></tt> object to automatically
derive these from the image file itself (provided the header
information in the file is correct).</p>
<span class="target" id="module-tkp.sourcefinder.image"></span><dl class="docutils">
<dt>Some generic utility routines for number handling and</dt>
<dd>calculating (specific) variances</dd>
</dl>
<dl class="class">
<dt id="tkp.sourcefinder.image.ImageData">
<em class="property">class </em><tt class="descclassname">tkp.sourcefinder.image.</tt><tt class="descname">ImageData</tt><big>(</big><em>data, beam, wcs, max_degradation=0.2, median_filter=0, mf_threshold=0, interpolate_order=1, back_sizex=32, back_sizey=32, margin=0, radius=0, fdr_alpha=0.01, residuals=True, deblend=False, deblend_nthresh=32, deblend_mincont=0.005, detection_threshold=10.0, analysis_threshold=3.0, structuring_element=[[0, 1, 0], [1, 1, 1], [0, 1, 0]], ew_sys_err=0.0, ns_sys_err=0.0, force_beam=False</em><big>)</big><a class="reference internal" href="../../../_modules/tkp/sourcefinder/image.html#ImageData"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.sourcefinder.image.ImageData" title="Permalink to this definition">¶</a></dt>
<dd><p>Encapsulates an image in terms of a numpy array + meta/headerdata.</p>
<p>This is your primary contact point for interaction with images: it icludes
facilities for source extraction and measurement, etc.</p>
<p>Sets up an ImageData object.</p>
<dl class="docutils">
<dt><em>Args:</em></dt>
<dd><ul class="first last simple">
<li>data (2D numpy.ndarray): actual image data</li>
<li>wcs (utility.coordinates.wcs): world coordinate system
specification</li>
<li>beam (3-tuple): beam shape specification as
(semimajor, semiminor, theta)</li>
</ul>
</dd>
</dl>
<dl class="attribute">
<dt id="tkp.sourcefinder.image.ImageData.backmap">
<tt class="descname">backmap</tt><a class="headerlink" href="#tkp.sourcefinder.image.ImageData.backmap" title="Permalink to this definition">¶</a></dt>
<dd><p>Background map</p>
</dd></dl>

<dl class="staticmethod">
<dt id="tkp.sourcefinder.image.ImageData.box_slice_about_pixel">
<em class="property">static </em><tt class="descname">box_slice_about_pixel</tt><big>(</big><em>x</em>, <em>y</em>, <em>box_radius</em><big>)</big><a class="reference internal" href="../../../_modules/tkp/sourcefinder/image.html#ImageData.box_slice_about_pixel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.sourcefinder.image.ImageData.box_slice_about_pixel" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a slice centred about (x,y), of width = 2*int(box_radius) + 1</p>
</dd></dl>

<dl class="method">
<dt id="tkp.sourcefinder.image.ImageData.clearcache">
<tt class="descname">clearcache</tt><big>(</big><big>)</big><a class="reference internal" href="../../../_modules/tkp/sourcefinder/image.html#ImageData.clearcache"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.sourcefinder.image.ImageData.clearcache" title="Permalink to this definition">¶</a></dt>
<dd><p>Zap any calculated data stored in this object.</p>
<p>Clear the background and rms maps, labels, clip, and any locally held
data. All of these can be reconstructed from the data accessor.</p>
<p>Note that this <em>must</em> be run to pick up any new settings.</p>
</dd></dl>

<dl class="attribute">
<dt id="tkp.sourcefinder.image.ImageData.data">
<tt class="descname">data</tt><a class="headerlink" href="#tkp.sourcefinder.image.ImageData.data" title="Permalink to this definition">¶</a></dt>
<dd><p>Masked image data</p>
</dd></dl>

<dl class="attribute">
<dt id="tkp.sourcefinder.image.ImageData.data_bgsubbed">
<tt class="descname">data_bgsubbed</tt><a class="headerlink" href="#tkp.sourcefinder.image.ImageData.data_bgsubbed" title="Permalink to this definition">¶</a></dt>
<dd><p>Background subtracted masked image data</p>
</dd></dl>

<dl class="method">
<dt id="tkp.sourcefinder.image.ImageData.extract">
<tt class="descname">extract</tt><big>(</big><em>det=None</em>, <em>anl=None</em>, <em>noisemap=None</em>, <em>bgmap=None</em>, <em>labelled_data=None</em>, <em>labels=None</em><big>)</big><a class="reference internal" href="../../../_modules/tkp/sourcefinder/image.html#ImageData.extract"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.sourcefinder.image.ImageData.extract" title="Permalink to this definition">¶</a></dt>
<dd><p>Kick off conventional (ie, RMS island finding) source extraction.</p>
<p>Kwargs:</p>
<blockquote>
<div><dl class="docutils">
<dt>det (float): detection threshold, as a multiple of the RMS</dt>
<dd>noise. At least one pixel in a source must exceed this
for it to be regarded as significant.</dd>
<dt>anl (float): analysis threshold, as a multiple of the RMS</dt>
<dd>noise. All the pixels within the island that exceed
this will be used when fitting the source.</dd>
</dl>
<p>noisemap (numpy.ndarray):</p>
<p>bgmap (numpy.ndarray):</p>
</div></blockquote>
<p>Returns:</p>
<blockquote>
<div>(..utility.containers.ExtractionResults):</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="tkp.sourcefinder.image.ImageData.fd_extract">
<tt class="descname">fd_extract</tt><big>(</big><em>alpha=None</em>, <em>anl=None</em>, <em>noisemap=None</em>, <em>bgmap=None</em><big>)</big><a class="reference internal" href="../../../_modules/tkp/sourcefinder/image.html#ImageData.fd_extract"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.sourcefinder.image.ImageData.fd_extract" title="Permalink to this definition">¶</a></dt>
<dd><p>False Detection Rate based source extraction.</p>
<p>See <a class="reference external" href="http://adsabs.harvard.edu/abs/2002AJ....123.1086H">Hopkins et al., AJ, 123, 1086 (2002)</a>.</p>
</dd></dl>

<dl class="method">
<dt id="tkp.sourcefinder.image.ImageData.fit_fixed_positions">
<tt class="descname">fit_fixed_positions</tt><big>(</big><em>sources</em>, <em>boxsize</em>, <em>threshold=None</em>, <em>fixed='position+error'</em><big>)</big><a class="reference internal" href="../../../_modules/tkp/sourcefinder/image.html#ImageData.fit_fixed_positions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.sourcefinder.image.ImageData.fit_fixed_positions" title="Permalink to this definition">¶</a></dt>
<dd><p>Convenience function to fit a list of sources at the given positions</p>
<p>This function wraps around fit_to_point().</p>
<p>Sources is a list of (ra, dec) tuples (not pixel coordinates).</p>
<p>All other arguments are the same as in fit_to_point(). In
particular, boxsize is in pixel coordinates as in
fit_to_point, not in sky coordinates.</p>
</dd></dl>

<dl class="method">
<dt id="tkp.sourcefinder.image.ImageData.fit_to_point">
<tt class="descname">fit_to_point</tt><big>(</big><em>x</em>, <em>y</em>, <em>boxsize</em>, <em>threshold</em>, <em>fixed</em><big>)</big><a class="reference internal" href="../../../_modules/tkp/sourcefinder/image.html#ImageData.fit_to_point"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.sourcefinder.image.ImageData.fit_to_point" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit an elliptical Gaussian to a specified point on the image.</p>
<p>The fit is carried on a square section of the image, of length
<em>boxsize</em> &amp; centred at pixel coordinates <em>x</em>, <em>y</em>. Any data
below <em>threshold</em> * rmsmap is not used for fitting. If <em>fixed</em>
is set to <tt class="docutils literal"><span class="pre">position</span></tt>, then the pixel coordinates are fixed
in the fit.</p>
<p>Returns an instance of <a class="reference internal" href="extract.html#tkp.sourcefinder.extract.Detection" title="tkp.sourcefinder.extract.Detection"><tt class="xref py py-class docutils literal"><span class="pre">tkp.sourcefinder.extract.Detection</span></tt></a>.</p>
</dd></dl>

<dl class="method">
<dt id="tkp.sourcefinder.image.ImageData.flux_at_pixel">
<tt class="descname">flux_at_pixel</tt><big>(</big><em>x</em>, <em>y</em>, <em>numpix=1</em><big>)</big><a class="reference internal" href="../../../_modules/tkp/sourcefinder/image.html#ImageData.flux_at_pixel"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.sourcefinder.image.ImageData.flux_at_pixel" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the background-subtracted flux at a certain position
in the map</p>
</dd></dl>

<dl class="attribute">
<dt id="tkp.sourcefinder.image.ImageData.grids">
<tt class="descname">grids</tt><a class="headerlink" href="#tkp.sourcefinder.image.ImageData.grids" title="Permalink to this definition">¶</a></dt>
<dd><p>Gridded RMS and background data for interpolating</p>
</dd></dl>

<dl class="method">
<dt id="tkp.sourcefinder.image.ImageData.label_islands">
<tt class="descname">label_islands</tt><big>(</big><em>detectionthresholdmap</em>, <em>analysisthresholdmap</em><big>)</big><a class="reference internal" href="../../../_modules/tkp/sourcefinder/image.html#ImageData.label_islands"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.sourcefinder.image.ImageData.label_islands" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a lablled array of pixels for fitting.</p>
<p>Args:</p>
<blockquote>
<div><p>detectionthresholdmap (numpy.ndarray):</p>
<p>analysisthresholdmap (numpy.ndarray):</p>
</div></blockquote>
<p>Returns:</p>
<blockquote>
<div><p>list of valid islands (list of int)</p>
<p>labelled islands (numpy.ndarray)</p>
</div></blockquote>
</dd></dl>

<dl class="attribute">
<dt id="tkp.sourcefinder.image.ImageData.pixmax">
<tt class="descname">pixmax</tt><a class="reference internal" href="../../../_modules/tkp/sourcefinder/image.html#ImageData.pixmax"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.sourcefinder.image.ImageData.pixmax" title="Permalink to this definition">¶</a></dt>
<dd><p>Maximum pixel value (pre-background subtraction)</p>
</dd></dl>

<dl class="attribute">
<dt id="tkp.sourcefinder.image.ImageData.pixmin">
<tt class="descname">pixmin</tt><a class="reference internal" href="../../../_modules/tkp/sourcefinder/image.html#ImageData.pixmin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.sourcefinder.image.ImageData.pixmin" title="Permalink to this definition">¶</a></dt>
<dd><p>Minimum pixel value (pre-background subtraction)</p>
</dd></dl>

<dl class="method">
<dt id="tkp.sourcefinder.image.ImageData.reliable_window">
<tt class="descname">reliable_window</tt><big>(</big><em>max_degradation=None</em><big>)</big><a class="reference internal" href="../../../_modules/tkp/sourcefinder/image.html#ImageData.reliable_window"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.sourcefinder.image.ImageData.reliable_window" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates limits over which the image may be regarded as
&#8220;reliable&#8221;.</p>
<p>Kwargs:</p>
<blockquote>
<div><dl class="docutils">
<dt>keyword max_degradation (float): astrometry accuracy</dt>
<dd>allowed. See description below</dd>
</dl>
</div></blockquote>
<p>Returns:</p>
<blockquote>
<div><dl class="docutils">
<dt>(numpy.ndarray): masked window where the FITS image</dt>
<dd>astrometry is valid</dd>
</dl>
</div></blockquote>
<p>This code calculates a window within a FITS image that is &#8220;reliable&#8221;,
i.e.  the mapping from pixel coordinates to celestial coordinates is
well defined.  Often this window equals the entire FITS image, in some
cases, e.g., in all-sky maps, this is not the case.  So there is some
user-allowed maximum degradation.</p>
<p>The degradation of the accuracy of astrometry due to projection
effects at a position on the sky phi radians away from the center of
the projection is equal to <tt class="docutils literal"><span class="pre">1/cos(phi)</span></tt>. So if you allow for a
maximum degradation of 10% the code will output pixels within a circle
with a radius of <tt class="docutils literal"><span class="pre">arccos(1/(1+0.1))</span> <span class="pre">=</span> <span class="pre">24.6</span></tt> degrees around the
center of the projection. The output FITS image will be the largest
possible square within that circle.</p>
<p>I assume that we are working with SIN projected images.  So in the
east-west direction (<tt class="docutils literal"><span class="pre">M=0</span></tt>) the pixel that is max_angle away from
the center of the SIN projection is
<tt class="docutils literal"><span class="pre">self.centrerapix+sin(max_angle)/raincr_rad</span></tt>. In the north-south
direction (<tt class="docutils literal"><span class="pre">L=0</span></tt>) the pixel that is max_angle away from the center
of the SIN projection is
<tt class="docutils literal"><span class="pre">self.centredecpix+sin(max_angle)/decincr_rad</span></tt>.  Now cutting out the
largest possible square is relatively straightforward.  Just multiply
both of these pixel offsets by <tt class="docutils literal"><span class="pre">0.5*sqrt(2)</span></tt>. See <a class="reference external" href="ftp://ftp.aoc.nrao.edu/pub/software/aips/TEXT/PUBL/AIPSMEMO27.PS">Non-Linear
Coordinate Systems in AIPS</a>,
paragraph 3.2, for details on SIN projection.</p>
<p><strong>NOTE: This is only valid for a SIN projection. Needs more thought
for other projection types.</strong></p>
</dd></dl>

<dl class="method">
<dt id="tkp.sourcefinder.image.ImageData.reverse_se">
<tt class="descname">reverse_se</tt><big>(</big><em>det=None</em><big>)</big><a class="reference internal" href="../../../_modules/tkp/sourcefinder/image.html#ImageData.reverse_se"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.sourcefinder.image.ImageData.reverse_se" title="Permalink to this definition">¶</a></dt>
<dd><p>Run source extraction on the negative of this image.</p>
<p>Obviously, there should be no sources in the negative image, so this
tells you about the false positive rate.</p>
<p>We need to clear cached data &#8211; backgroung map, cached clips, etc &#8211;
before &amp; after doing this, as they&#8217;ll interfere with the normal
extraction process. If this is regularly used, we&#8217;ll want to
implement a separate cache.</p>
</dd></dl>

<dl class="attribute">
<dt id="tkp.sourcefinder.image.ImageData.rmsmap">
<tt class="descname">rmsmap</tt><a class="headerlink" href="#tkp.sourcefinder.image.ImageData.rmsmap" title="Permalink to this definition">¶</a></dt>
<dd><p>RMS map</p>
</dd></dl>

<dl class="method">
<dt id="tkp.sourcefinder.image.ImageData.stats">
<tt class="descname">stats</tt><big>(</big><em>nbins=100</em>, <em>plot=True</em><big>)</big><a class="reference internal" href="../../../_modules/tkp/sourcefinder/image.html#ImageData.stats"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.sourcefinder.image.ImageData.stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Produce brief statistical report on this image, suitable for
printing.</p>
<p>Kwargs:</p>
<blockquote>
<div><dl class="docutils">
<dt>nbins (int): how many bins to divide the pixel values into</dt>
<dd>for building a historgram.</dd>
</dl>
<p>plot (bool): print histogram?</p>
</div></blockquote>
<p>Deprecated.</p>
</dd></dl>

<dl class="attribute">
<dt id="tkp.sourcefinder.image.ImageData.xdim">
<tt class="descname">xdim</tt><a class="reference internal" href="../../../_modules/tkp/sourcefinder/image.html#ImageData.xdim"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.sourcefinder.image.ImageData.xdim" title="Permalink to this definition">¶</a></dt>
<dd><p>X pixel dimension of (unmasked) data</p>
</dd></dl>

<dl class="attribute">
<dt id="tkp.sourcefinder.image.ImageData.ydim">
<tt class="descname">ydim</tt><a class="reference internal" href="../../../_modules/tkp/sourcefinder/image.html#ImageData.ydim"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#tkp.sourcefinder.image.ImageData.ydim" title="Permalink to this definition">¶</a></dt>
<dd><p>Y pixel dimension of (unmasked) data</p>
</dd></dl>

</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../index.html">
              <img class="logo" src="../../../_static/lofar.png" alt="Logo"/>
            </a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="introduction.html"
                        title="previous chapter">Introduction</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="extract.html"
                        title="next chapter"><tt class="docutils literal"><span class="pre">tkp.sourcefinder.extract</span></tt> &#8211; Source extraction routines</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../../_sources/devref/tkp/sourcefinder/image.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="extract.html" title="tkp.sourcefinder.extract – Source extraction routines"
             >next</a> |</li>
        <li class="right" >
          <a href="introduction.html" title="Introduction"
             >previous</a> |</li>
        <li><a href="../../../index.html">LOFAR Transients Pipeline 1.0 documentation</a> &raquo;</li>
          <li><a href="../../index.html" >Developer&#8217;s Reference Guide</a> &raquo;</li>
          <li><a href="../index.html" >Library &amp; API</a> &raquo;</li>
          <li><a href="index.html" >Sourcefinder package</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, LOFAR Transients Key Project.
    </div>
  </body>
</html>