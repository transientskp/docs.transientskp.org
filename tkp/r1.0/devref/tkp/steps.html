<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Trap logic flow overview &mdash; LOFAR Transients Pipeline 1.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../_static/lofar.ico"/>
    <link rel="top" title="LOFAR Transients Pipeline 1.0 documentation" href="../../index.html" />
    <link rel="up" title="Library &amp; API" href="index.html" />
    <link rel="next" title="tkp.accessors – Image container classes" href="accessors.html" />
    <link rel="prev" title="Configuration" href="config.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="accessors.html" title="tkp.accessors – Image container classes"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="config.html" title="Configuration"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">LOFAR Transients Pipeline 1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Developer&#8217;s Reference Guide</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Library &amp; API</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="trap-logic-flow-overview">
<span id="steps-section"></span><h1>Trap logic flow overview<a class="headerlink" href="#trap-logic-flow-overview" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Last updated:</th><td class="field-body">2013-10-14</td>
</tr>
</tbody>
</table>
<div class="section" id="main-logic-flow">
<h2>Main logic flow<a class="headerlink" href="#main-logic-flow" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><ul class="simple">
<li>First, we run <tt class="xref py py-mod docutils literal"><span class="pre">persistence</span></tt> extracts metadata from the image headers,
and creates corresponding entries in the database.</li>
<li>Next, <tt class="xref py py-mod docutils literal"><span class="pre">quality_check</span></tt> performs various checks on each image file,
which may result in some being marked as &#8216;rejected&#8217;
(unsuitable for further processing). Subsequent recipes only act on &#8216;good&#8217;
images.</li>
<li><tt class="xref py py-mod docutils literal"><span class="pre">source_extraction.py</span></tt>  Performs blind extraction and source association.</li>
<li><tt class="xref py py-mod docutils literal"><span class="pre">monitoringlist.py</span></tt> Performs a crude transient candidates search
(<tt class="xref py py-func docutils literal"><span class="pre">monitoringlist.mark_sources()</span></tt>) to check for new locations worth
monitoring, and then performs forced extractions
(<tt class="xref py py-func docutils literal"><span class="pre">monitoringlist.update_monitoringlist()</span></tt>).</li>
<li><tt class="xref py py-mod docutils literal"><span class="pre">transient_search.py</span></tt> First selects sources from the runningcatalog which
satisfy the user-supplied criteria for variability indices.
The variability indices are then used to calculate a chi-squared value for
a test against a model of constant flux (null hypothesis).
Finally, this chi-squared value is used to compute the probability that
the null hypothesis is false, i.e. how likely that the source is
intrisincally transient / variable.</li>
<li><tt class="xref py py-mod docutils literal"><span class="pre">feature_extraction.py</span></tt> Calculates various properties for the
lightcurves of each identified transient source,
e.g. mean, median, skew, peak, etc.</li>
<li><tt class="xref py py-mod docutils literal"><span class="pre">classification.py</span></tt> (Basically a placeholder currently).</li>
<li><tt class="xref py py-mod docutils literal"><span class="pre">prettyprint.py</span></tt> Prints the transients identified.</li>
</ul>
</div></blockquote>
<div class="section" id="features-overview">
<h3>Features overview<a class="headerlink" href="#features-overview" title="Permalink to this headline">¶</a></h3>
<p>The Trap has several steps; most steps are optional, but leaving out
some will make little sense. The steps are:</p>
<ul>
<li><p class="first"><strong>Source extraction, database storage and source association.</strong> This
will detect sources in the current image, stores the sources in a
database and associates the sources with 1) previously detected
sources from the same dataset and 2) existing catalogs.</p>
<p>Note: currently, this is one step (recipe), though it may be split
up into two steps for clarity (extraction and association are quite
different steps).</p>
</li>
<li><p class="first"><strong>Monitor existing or user-added sources.</strong> This takes care of measuring fluxes
of transient sources, even when these have disappeared below the detection
threshold, so that the light curve is measured with upper limits instead.
This step also takes care of sources that were obtained from elsewhere and
manually added, such as a new X-ray source: the pipeline will now monitor
this position so the full LOFAR light curve for this source can be measured.</p>
</li>
<li><p class="first"><strong>Transient detection.</strong> All existing light curves (ie, associated sources from
the previous step) will be examined to determine if sources are variable.
(The basic algorithm for this is a chi-squared calculation and check for
significant deviations from the average.)</p>
<p>Not implemented yet, but in a future version: sources will be
compared to sources in the LOFAR global sky model, to determine if their flux
level differs from their cataloged value.</p>
</li>
<li><p class="first"><strong>Feature extraction.</strong> This will attempt to extract various
characteristics (peak flux, duration, background level, flux
increase and decrease, spectral shape, standard statistical values
such as mean, standard deviation, skew and kurtosis) from any
transient detected in the previous routine.</p>
<p>Since most algorithms in the above routine rely on a good
measurement of the average background/steady-state value, these
algorithms may not return any (usable) values when only few
measurements are available.</p>
</li>
</ul>
</div>
</div>
<div class="section" id="coming-soon">
<h2>Coming soon<a class="headerlink" href="#coming-soon" title="Permalink to this headline">¶</a></h2>
<p>A number of features are not currently implemented in the Trap logic flow, but
are under development.</p>
<ul>
<li><p class="first"><strong>Source classification.</strong> This routine will attempt to classify a
source. Multiple classifications are possible, each with its own
weight (a threshold can be set to only output classifications above
a certain weight).</p>
<p>This routine is obviously very dependent on the results of the feature
extraction routine. Ie, badly or no extracted features will
obviously not lead to a (valid) classification.</p>
<p>Since, at the moment, there are few to none training data sets for
the classification, this step follows a simple manual tree
classification, where each source gets a value (weight) associated
with a certain type of classification. The possible classifications,
however, are fully preprogrammed.</p>
</li>
<li><p class="first">An <strong>alert system.</strong> This will send emails to interested parties, depending on
criteria set beforehand (which are compared to the results found in the
classification step). In the future, this step should be replaced by sending
out VOEvents, and the current implementation is essentially a simple way of
alerting people to possible transients detected by the pipeline.</p>
</li>
<li><p class="first">An <strong>imaging</strong> step. This actually belongs to the standard
imaging pipeline (SIP), but can be implemented into the Trap for
convenience (so to have an end-to-end pipeline).
<cite>Currently out of commission, awaiting upstream updates to the LOFAR pipeline.</cite></p>
</li>
<li><p class="first">A <strong>time slicing</strong> routine. This can be used when a long observation
(dataset) needs to split into smaller (shorter) chunks, which are
then compared among each other to find transients within the dataset
(ie, not by comparing with existing catalogs).</p>
<p>The two routines above are not used when the input to the Trap
consists of a list of individual images. In this case the Trap will
just loop over this list of images.</p>
</li>
</ul>
</div>
<div class="section" id="steps-and-their-parameters">
<h2>Steps and their parameters<a class="headerlink" href="#steps-and-their-parameters" title="Permalink to this headline">¶</a></h2>
<p>This page gives a very brief description of each script / recipe used in the
Trap workflow, and details the parameters supplied
either via command line arguments (in the case of top-level scripts) or via
parameter sets (for the recipes).</p>
<div class="section" id="persistence">
<h3>persistence<a class="headerlink" href="#persistence" title="Permalink to this headline">¶</a></h3>
<p>Checks for accessibility of each listed image file, inserts it into the database,
and stores in the MongoDB image store if configured to do so.</p>
</div>
<div class="section" id="source-extraction">
<h3>source_extraction<a class="headerlink" href="#source-extraction" title="Permalink to this headline">¶</a></h3>
<p>Run the source finding routine. In addition, this recipe will store
the detected sources inside the database, and tries to associate the
new sources with existing ones.</p>
<ul class="simple">
<li>inputs:<ul>
<li>image: list of (FITS) images.</li>
<li>parset: parameter set containg the following optional
settings. Note that these setting supersede the values in your
(local) TKP configuration file.<ul>
<li>detection.threshold: peak detection threshold for a source to be
found.</li>
<li>analysis.threshold: threshold to include neighbouring pixels
into the determination of the source details.</li>
<li>association.radius: radius in units of the default De Ruiter
radius to associate sources with previously extracted sources.</li>
<li>backsize.x, backsize.y: mesh size to determine the background
level.</li>
</ul>
</li>
<li>nproc: number of maximum simultaneous processors per node. Useful
when performing source extraction on multiple subbands
simultaneously.</li>
</ul>
</li>
<li>outputs:<ul>
<li>dataset_id: see the dataset_id entry in the inputs.</li>
</ul>
</li>
</ul>
<p>Notes:</p>
<ul class="simple">
<li>In a future Trap version, the source association part may get its
own recipe.</li>
<li>A future version will allow for other images than just FITS.</li>
</ul>
</div>
<div class="section" id="transient-search">
<span id="transient-search-recipe"></span><h3>transient_search<a class="headerlink" href="#transient-search" title="Permalink to this headline">¶</a></h3>
<p>Search through all matched sources and find variable sources by
looking for deviations in their light curve.</p>
<ul>
<li><p class="first">inputs:</p>
<ul class="simple">
<li>parset: parameter set, with the following parameters:<ul>
<li>probability.threshold: likeliness above which the variable is
assumed a transient (between 0 and 1).</li>
<li>probability.minpoints: minimum number of light curve data points
to determine the variability of a source.</li>
<li>probability.eta_lim: eta (least-squared sum) limit above which
a source is assumed to be variable (related to <cite>threshold</cite>
above).</li>
</ul>
</li>
</ul>
<blockquote>
<div><ul class="simple">
<li>probability.V_lim: limit for V (measure of variation around the
mean value) above which a source is assumed to be variable.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">outputs:</p>
<ul class="simple">
<li>transient_ids: list of database IDs of the sources which are found
to be transient.</li>
<li>siglevels: significance levels of the &#8220;transientness&#8221;.</li>
<li>transients: list of <tt class="docutils literal"><span class="pre">Transient</span></tt> objects.</li>
</ul>
</li>
</ul>
<p>This routine is implemented by performing a database search, and thus
the recipe is simply run on the front-end node.</p>
</div>
<div class="section" id="feature-extraction">
<span id="id1"></span><h3>feature_extraction<a class="headerlink" href="#feature-extraction" title="Permalink to this headline">¶</a></h3>
<p>Obtain characteristics from detected transient sources. This may fail
(ie, produces None or 0 for values) when little to no
background/steady-state information is known.</p>
<p>Current characteristics obtained are:</p>
<ul class="simple">
<li>duration</li>
<li>peak flux</li>
<li>increase and decrease from background to peak and back, and their
ratio.</li>
</ul>
<p>Each feature extraction is run as a separate node.</p>
<ul class="simple">
<li>inputs:<ul>
<li>transients: list of <tt class="docutils literal"><span class="pre">Transient</span></tt> objects, previously obtained with the
transient_search recipe.</li>
<li>nproc: number of maximum simultaneous processors per node.</li>
</ul>
</li>
<li>outputs:<ul>
<li>transients: list of <tt class="docutils literal"><span class="pre">Transient</span></tt> objects.</li>
</ul>
</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/lofar.png" alt="Logo"/>
            </a></p>
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Trap logic flow overview</a><ul>
<li><a class="reference internal" href="#main-logic-flow">Main logic flow</a><ul>
<li><a class="reference internal" href="#features-overview">Features overview</a></li>
</ul>
</li>
<li><a class="reference internal" href="#coming-soon">Coming soon</a></li>
<li><a class="reference internal" href="#steps-and-their-parameters">Steps and their parameters</a><ul>
<li><a class="reference internal" href="#persistence">persistence</a></li>
<li><a class="reference internal" href="#source-extraction">source_extraction</a></li>
<li><a class="reference internal" href="#transient-search">transient_search</a></li>
<li><a class="reference internal" href="#feature-extraction">feature_extraction</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="config.html"
                        title="previous chapter">Configuration</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="accessors.html"
                        title="next chapter"><tt class="docutils literal"><span class="pre">tkp.accessors</span></tt> &#8211; Image container classes</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/devref/tkp/steps.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="accessors.html" title="tkp.accessors – Image container classes"
             >next</a> |</li>
        <li class="right" >
          <a href="config.html" title="Configuration"
             >previous</a> |</li>
        <li><a href="../../index.html">LOFAR Transients Pipeline 1.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Developer&#8217;s Reference Guide</a> &raquo;</li>
          <li><a href="index.html" >Library &amp; API</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, LOFAR Transients Key Project.
    </div>
  </body>
</html>