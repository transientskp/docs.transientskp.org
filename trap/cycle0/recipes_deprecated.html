

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>datamapper &mdash; TRAP 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="TRAP 1.0 documentation" href="index.html" />
    <link rel="prev" title="Monitoring list" href="monitoringlist.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="monitoringlist.html" title="Monitoring list"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">TRAP 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="datamapper">
<h1>datamapper<a class="headerlink" href="#datamapper" title="Permalink to this headline">¶</a></h1>
<p>This recipe is part of the default pipeline framework.</p>
<p>Calculates a file that maps the datasets to their respective storage
or compute nodes and subclusters, so that the pipeline hands out the
correct jobs (with datafiles) to the correct nodes.</p>
<ul class="simple">
<li>inputs:<ul>
<li>mapfile: the filename (full path) of the mapping file</li>
<li>subcluster (optional): is the subcluster name is not &#8220;encoded&#8221;
inside the file name (that is, on CEP I the second directory in
the path name contains the subcluster), set this option to
indicate the subcluster you&#8217;re using. This will likely be
&#8220;heastro&#8221; or &#8220;lofar1&#8221;.</li>
</ul>
</li>
<li>outputs:<ul>
<li>the mapping filename. This is often used by the next recipe(s).</li>
</ul>
</li>
</ul>
<p>Important note: the datamapper recipe looks at the file path to
determine the node and subcluster. This only works on the LOFAR
Groningen offline cluster; for heastro1, there is a separate recipe
with a slight modification, so that heastro1 is always picked up as
the compute node.</p>
</div>
<div class="section" id="vdsmaker">
<h1>vdsmaker<a class="headerlink" href="#vdsmaker" title="Permalink to this headline">¶</a></h1>
<p>This recipe is part of the default pipeline framework.</p>
<p>VDS files are another way to map files to their respective nodes; in
addition, VDS files store information like time and frequency range.</p>
<p>The vdsmaker recipe creates local and a global VDS file for the specified files.</p>
<ul class="simple">
<li>Inputs:<ul>
<li>gvds: Global VDS output file name.</li>
<li>directory: the output directory (for the local individual VDS files).</li>
<li>makevds: the makevds executable</li>
<li>combinevds: the combinevds executable</li>
<li>unlink: remove the local individual VDS files are combining them
into a GVDS file? By default this is set to True, but if you need
the local VDS files in another recipe, set this is False.</li>
<li>nproc: maximum number of simultaneous processes per output node.</li>
</ul>
</li>
<li>outputs:<ul>
<li>gvds: the GVDS filename</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="ndppp">
<h1>ndppp<a class="headerlink" href="#ndppp" title="Permalink to this headline">¶</a></h1>
<p>This recipe is part of the default pipeline framework.</p>
<p>NDPPP is the default flagger for LOFAR (but can be replaced with the AOFlagger).</p>
<ul class="simple">
<li>inputs:<ul>
<li>executable: the NDPPP executable</li>
<li>initscript: an initialization script that setups up the
environment for NDPPP. Usually lofarinit.sh works fine.</li>
<li>parset: the parset configuration file for NDPPP</li>
<li>suffix: suffix to add to the output (MS) file.</li>
<li>working_directory: where to store the new flagged files</li>
<li>data_start_time, data_end_time: chop files to selected times. Used
to prevent eg BBS from crashing on subbands with unequal
durations.</li>
<li>nproc: maximum number of simultaneous processes per output node.</li>
<li>nthreads: number of threads pr NDPPP process</li>
<li>mapfile: output mapping file (see also the <cite>datamapper</cite> recipe).</li>
<li>clobber: remove pre-existing output files.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="bbs">
<h1>bbs<a class="headerlink" href="#bbs" title="Permalink to this headline">¶</a></h1>
<p>This recipe is a wrapper around the new_bbs recipe that is part of the
default pipeline framework. It adds the <cite>nproc</cite> option, so that BBS
won&#8217;t eat up all processing power if you don&#8217;t want it to.</p>
<p>BlackBoard Selfcal (BBS) is the calibration routine for LOFAR.</p>
<p>BBS uses quite a few parameters, including ones to access the
PostgreSQL database is uses behind the scenes and ones that point to
external commands.</p>
<ul class="simple">
<li>inputs:<ul>
<li>control_exec: BBS control executable</li>
<li>kernel_exec: BBS kernel executable</li>
<li>initscript: an initialization script that setups up the
environment for BBS. Usually lofarinit.sh works fine.</li>
<li>parset: the BBS configuration parset</li>
<li>db_key: a key to identify the BBS session</li>
<li>db_host: the PostgreSQL database host name</li>
<li>db_user: the PostgreSQL database user, usually postgres.</li>
<li>db_name: the PostgreSQL database, usually your username.</li>
<li>data_mapfile: the mapping file that will contain the BBS
calibrated data. Any file (and file name) will do, but it is
probably best to this in the parset directory.</li>
<li>skymodel: an explicite sky model to be used by BBS. Usually,
however, the sky model is set up on the fly using the catalogs in
the database. See the section <cite>skymodel</cite> below.</li>
<li>nproc: maximum number of simultaneous processes per output node.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="vdsreader">
<h1>vdsreader<a class="headerlink" href="#vdsreader" title="Permalink to this headline">¶</a></h1>
<p>Very simple recipe to read through a global VDS file.</p>
<ul class="simple">
<li>inputs:<ul>
<li>gvds: the gvds file that will be read. By default this is probably
<tt class="docutils literal"><span class="pre">%(runtime_directory)s/jobs/%(job_name)s/vds/%(job_name)s.gvds</span></tt>.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="parmdb">
<h1>parmdb<a class="headerlink" href="#parmdb" title="Permalink to this headline">¶</a></h1>
<p>Adds a parameter database to input Measurement Sets.</p>
<ul class="simple">
<li>inputs:<ul>
<li>executable: the <cite>parmdbm</cite> executable. By default this is probably
<tt class="docutils literal"><span class="pre">%(lofarroot)s/bin/parmdbm</span></tt>.</li>
<li>working_directory: just the default working directory</li>
<li>mapfile: output mapping file.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="sourcedb">
<h1>sourcedb<a class="headerlink" href="#sourcedb" title="Permalink to this headline">¶</a></h1>
<p>Adds a source database to input Measurement Sets.</p>
<ul class="simple">
<li>inputs:<ul>
<li>executable: the <cite>makesourcedb</cite> executable. By default this is
probably <tt class="docutils literal"><span class="pre">%(lofarroot)s/bin/makesourcedb</span></tt>.</li>
<li>skymodel: the BBS sky model (created by the skymodel
recipe). Something like
<tt class="docutils literal"><span class="pre">%(runtime_directory)s/jobs/%(job_name)s/parsets/bbs.skymodel</span></tt></li>
<li>working_directory: just the default working directory</li>
<li>mapfile: output mapping file.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="skymodel">
<h1>skymodel<a class="headerlink" href="#skymodel" title="Permalink to this headline">¶</a></h1>
<p>Creates a sky model from the database to be used by BBS.</p>
<ul class="simple">
<li>inputs:<ul>
<li>ra, dec: Right Ascension and declination of the sky model centre
(in floating point degrees).</li>
<li>search_size: radius of the circle in which to find sources for the
sky model.</li>
<li>min_flux: minimum integrated flux (Jy) for selecting database
sources.</li>
<li>skymodel_file: output filename</li>
</ul>
</li>
<li>outputs:<ul>
<li>source_name, source_flux: the central source name and flux.</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="time-slicing">
<h1>time_slicing<a class="headerlink" href="#time-slicing" title="Permalink to this headline">¶</a></h1>
<p>Creates a list of time slices, that can be used to iterate on sections
of the data.</p>
<p>The various imagers also contain time slicing options, but because of
the way the imager create the images, one looses the necessary
metadata. The time_slicing recipe attempts to fix this, by slicing up
the actual MS and creating subdirectories for those sliced MSs. Note
that the sliced MS is just a &#8220;view&#8221; into the original, so there is
little extra disk space needed.</p>
<p>Once metadata gets properly transported into created images, this
recipe will become obsolete.</p>
<p>See also the <cite>img2fits</cite> recipe.</p>
<ul class="simple">
<li>inputs:<ul>
<li>interval: time interval, specified in hh:mm:ss. Multiple slices
will be generated with this interval size; the last slice will at
least be as large as the specified time interval: a 5 hour
observations split into 2 hours will result in a 2 and 3 hour slice.</li>
<li>gvds_file: file name of the GVDS file</li>
<li>mapfiledir = directory to store datamapper files (eg parset directory).</li>
<li>nproc: number of maximum simultaneous processors per node</li>
</ul>
</li>
<li>outputs:<ul>
<li>timesteps: list of 3-tuples, each tuple containing <tt class="docutils literal"><span class="pre">(start_time,</span>
<span class="pre">end_time,</span> <span class="pre">MS</span> <span class="pre">path)</span></tt>.</li>
<li>mapfiles: list of datamapper files, one for each timeslice (same
order as timesteps).</li>
</ul>
</li>
</ul>
<p>Once data is sliced, you can then iterate through it, for example:</p>
<div class="highlight-python"><pre>outputs = self.run_task("time_slicing", gvds_file=gvds_file)
mapfiles = outputs['mapfiles']
subdirs = ["%d" % int(starttime) for starttime, endtime in
           outputs['timesteps']]
for iteration, (mapfile, subdir) in enumerate(zip(mapfiles,
                                                subdirs)):</pre>
</div>
</div>
<div class="section" id="cimager-trap">
<h1>cimager_trap<a class="headerlink" href="#cimager-trap" title="Permalink to this headline">¶</a></h1>
<p><strong>This recipe, and the cimager, is now deprecated. Please use the awimager recipe</strong>.</p>
<p>A slightly more TRAP specific version of the SIP cimager recipe. It
stores the host and original MS in the outputs, which can be used to
obtain the ncessary meta data when source finding is run.</p>
<ul class="simple">
<li>inputs:<ul>
<li>imager_exec: cimager executable</li>
<li>convert_exec: convertimagerparset executable</li>
<li>make_vds, combine_vds: makevds and combinevds executables</li>
<li>vds_dir: VDS working directory</li>
<li>parset: imager parset, in mwimager or cimager format</li>
<li>parset_type = &#8220;mwimager&#8221; (default) or &#8220;cimager&#8221;</li>
<li>results_dir = directory to store resulting images. Note that for
TRAP, it is better to store images on the local nodes, for the
conversion to FITS (see <cite>img2fits</cite>).</li>
<li>nproc: number of maximum simultaneous processors per node</li>
<li>timestep: ignored (see <cite>time_slicing</cite>).</li>
</ul>
</li>
<li>outputs:<ul>
<li>gvds: the global VDS file</li>
<li>images: list of tuples holding the image name and original MS
name. The image name consists is of the format <tt class="docutils literal"><span class="pre">host:path</span></tt>.
This list is used for conversion to FITS, including the meta data
(taken from the MS).</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="awimager">
<h1>awimager<a class="headerlink" href="#awimager" title="Permalink to this headline">¶</a></h1>
<p>Run the awimager.</p>
<ul class="simple">
<li>inputs:<ul>
<li>executable: the awimager executable</li>
<li>parset: the parameter set that contains all the awimager
options. See below for more explanation.</li>
<li>nproc: number of maximum simultaneous processors per
node. <strong>Safest to leave this at one (the default)</strong>. See below for
an explanation.</li>
<li>nthreads: Number of simultaneous threads per process. See below
for an explanation.</li>
</ul>
</li>
</ul>
<p>The parameter set for the awimager specifies all the options that are
normally specified on the command line when running the awimager. You
can run <cite>awimager -h</cite> to see all these options.</p>
<p>A number of options are ignored, since these do not make sense in the
context of a pipeline recipe:</p>
<ul class="simple">
<li>hdf5, fits: the output format is fixed to be a CASA image.</li>
<li>ms, image, restored: the input and output filenames are fixed.</li>
</ul>
<p>All other options can (and should) be specified using the parset. Example:</p>
<div class="highlight-python"><pre>npix = 128
verbose = 0
niter = 100
weight = natural
wmax = 500
npix = 256
cellsize = 30arcsec
data = CORRECTED_DATA
padding = 1.
niter = 10
wprojplanes = 50
timewindow = 300
StepApplyElement = 2
stokes = I
threshold = 0
operation = csclean</pre>
</div>
<div class="section" id="nproc-nthreads">
<h2>nproc &amp; nthreads<a class="headerlink" href="#nproc-nthreads" title="Permalink to this headline">¶</a></h2>
<p>The awimager is parallelised, so that a single awimager run can use
multiple cores (thus making it faster); the number of cores used to be
run simultaneously is specified using the nthreads configuration
parameter.</p>
<p>Of course, there is also the option of running multiple awimager
together, e.g. when processing multiple subbands. This may cause
problems, however: the awimager creates some extra files, that have a
fixed filename (independent of the input MS file name); when the
subbands being processed are in the same directory, these extra files
start to overwrite each other, causing the awimager to (likely)
crash. There, until there is a work around, it is advised to leave
<cite>nproc</cite> at 1, and use <cite>nthreads</cite> instead to speed up the awimager
process.</p>
<p>The additional advantage of using <cite>nthreads</cite> over <cite>nproc</cite> is that,
even for the processing of a single subband, a speed gain is obtained,
which wouldn&#8217;t be possible using <cite>nproc</cite>.</p>
</div>
</div>
<div class="section" id="img2fits">
<h1>img2fits<a class="headerlink" href="#img2fits" title="Permalink to this headline">¶</a></h1>
<p>Convert a CASA image to a FITS file, including the necessary meta data
(header keywords) to run source finding. These meta data are found
from the sliced MSs created using the <cite>time_slicing</cite> recipe.</p>
<p>It also combines the subbands into a single image.</p>
<ul class="simple">
<li>inputs:<ul>
<li>images: list of images, specified as 2-tuples <tt class="docutils literal"><span class="pre">(image_name,</span>
<span class="pre">MS_name)</span></tt>.</li>
<li>results_dir: directory to store the resulting images</li>
<li>combine: how to combine the (subband) images: <tt class="docutils literal"><span class="pre">average</span></tt>
(default) or <tt class="docutils literal"><span class="pre">sum</span></tt>.</li>
<li>nproc: number of maximum simultaneous processors per node</li>
</ul>
</li>
<li>outputs:<ul>
<li>fitsfiles: list of output FITS files</li>
<li>combined_fitsfile: combined image from all subbands.</li>
</ul>
</li>
</ul>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
    <p class="logo"><a href="index.html">
      <img class="logo" src="_static/ackbar.png" alt="Ackbar" title="It's a TRAP!" />
    </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">datamapper</a></li>
<li><a class="reference internal" href="#vdsmaker">vdsmaker</a></li>
<li><a class="reference internal" href="#ndppp">ndppp</a></li>
<li><a class="reference internal" href="#bbs">bbs</a></li>
<li><a class="reference internal" href="#vdsreader">vdsreader</a></li>
<li><a class="reference internal" href="#parmdb">parmdb</a></li>
<li><a class="reference internal" href="#sourcedb">sourcedb</a></li>
<li><a class="reference internal" href="#skymodel">skymodel</a></li>
<li><a class="reference internal" href="#time-slicing">time_slicing</a></li>
<li><a class="reference internal" href="#cimager-trap">cimager_trap</a></li>
<li><a class="reference internal" href="#awimager">awimager</a><ul>
<li><a class="reference internal" href="#nproc-nthreads">nproc &amp; nthreads</a></li>
</ul>
</li>
<li><a class="reference internal" href="#img2fits">img2fits</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="monitoringlist.html"
                        title="previous chapter">Monitoring list</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/recipes_deprecated.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="monitoringlist.html" title="Monitoring list"
             >previous</a> |</li>
        <li><a href="index.html">TRAP 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, LOFAR Transients Key Project.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>