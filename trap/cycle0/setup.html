

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Setup &mdash; TRAP 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="TRAP 1.0 documentation" href="index.html" />
    <link rel="next" title="Scripts" href="scripts.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="scripts.html" title="Scripts"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">TRAP 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="setup">
<h1>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Last updated:</th><td class="field-body">2012-11-26</td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The workflow described here has been largely superseded by the
<tt class="docutils literal"><span class="pre">trap-manage</span></tt> script - documentation for which is coming soon.</p>
</div>
<div class="section" id="preamble">
<h2>Preamble<a class="headerlink" href="#preamble" title="Permalink to this headline">¶</a></h2>
<p>A few variables are used in the documentation below, indicating
relevant directories that may differ from system to system:</p>
<ul>
<li><p class="first"><span class="target" id="index-0"></span><tt class="xref std std-envvar docutils literal"><span class="pre">${TKP}</span></tt>: the base TKP directory on your system. On the heastro
machines, this would be <tt class="file docutils literal"><span class="pre">/opt/tkp/tkp</span></tt>.</p>
</li>
<li><p class="first"><span class="target" id="index-1"></span><tt class="xref std std-envvar docutils literal"><span class="pre">${WORK}</span></tt>: your working directory for the pipeline, that is, where
the jobs control is kept. You can store this were you like, often in
<tt class="file docutils literal"><span class="pre">$</span><em><span class="pre">HOME</span></em><span class="pre">/pipeline_runtime</span></tt>. This directory contains the <tt class="file docutils literal"><span class="pre">jobs/</span></tt>
subdirectory and, optionally, the <tt class="file docutils literal"><span class="pre">trap.cfg</span></tt> as well.</p>
</li>
<li><p class="first"><span class="target" id="index-2"></span><tt class="xref std std-envvar docutils literal"><span class="pre">${CONFIG}</span></tt>: the main configuration file for the pipeline framework.
It contains sections such as <tt class="docutils literal"><span class="pre">[DEFAULT]</span></tt>, <tt class="docutils literal"><span class="pre">[layout]</span></tt>, <tt class="docutils literal"><span class="pre">[cluster]</span></tt>,
<tt class="docutils literal"><span class="pre">[deploy]</span></tt> and <tt class="docutils literal"><span class="pre">[logging]</span></tt>.</p>
</li>
<li><p class="first">You will also need a TKP configuration file that has the database
login details, unless you can rely upon the default (below), The TKP
configuration should be <tt class="file docutils literal"><span class="pre">$</span><em><span class="pre">HOME</span></em><span class="pre">/.tkp.cfg</span></tt>, and has the same syntaxa
as the other pipeline configuration files. The default configuration
for the pipeline looks as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">database</span><span class="p">]</span>
<span class="n">enabled</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">host</span> <span class="o">=</span> <span class="n">ldb001</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">tkp</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">tkp</span>
<span class="n">password</span> <span class="o">=</span> <span class="n">tkp</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">50000</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="on-heastro">
<h2>On heastro<a class="headerlink" href="#on-heastro" title="Permalink to this headline">¶</a></h2>
<p>The necessary TKP libraries are installed in <tt class="file docutils literal"><span class="pre">/opt/tkp/latest</span></tt>.  The
last part of this path is a symbolic link to a nightly build in
<tt class="file docutils literal"><span class="pre">/opt/tkp/yyyy-mm-dd-hh-mm/</span></tt>; use a specific nightly build if you have
long-running jobs or need a specific TKP library version.</p>
<p>Within the <tt class="file docutils literal"><span class="pre">/opt/tkp/latest</span></tt> directory, there are two subdirectories:
<tt class="file docutils literal"><span class="pre">lib/</span></tt> and <tt class="file docutils literal"><span class="pre">bin/</span></tt>. The former contents the required TKP libraries
and also all the Trap recipes; the latter contains stand-alone scripts which
may be helpful in managing your pipelines.</p>
<p>Your <span class="target" id="index-3"></span><a class="reference external" href="http://docs.python.org/using/cmdline.html#envvar-PYTHONPATH" title="(in Python v2.7)"><tt class="xref std std-envvar docutils literal"><span class="pre">PYTHONPATH</span></tt></a> and the <tt class="docutils literal"><span class="pre">ppath</span></tt> variable in your main
configuration file will need to include the
<tt class="file docutils literal"><span class="pre">lib/pythonX.Y</span></tt>, with <cite>X.Y</cite> being the version of Python in use on your
system (2.6 at present on <tt class="docutils literal"><span class="pre">heastro1</span></tt>). You will also need to include
<tt class="file docutils literal"><span class="pre">/opt/LofIm/lofar/lib/python2.6/dist-packages</span></tt> to pick up the LOFAR
pipeline framework.</p>
<p>Other dependencies are system-wide installed.</p>
<p>Your <tt class="docutils literal"><span class="pre">lpath</span></tt> in your configuration file needs to include:</p>
<ul class="simple">
<li><tt class="file docutils literal"><span class="pre">/opt/LofIm/lofar/lib</span></tt></li>
<li><tt class="file docutils literal"><span class="pre">/opt/tkp/latest/lib</span></tt></li>
</ul>
<p>Now set up your working directory structure and configuration files in
the usual pipeline way.  Example configuration files can be copied and
adjusted from <tt class="file docutils literal"><span class="pre">/home/evert/work/trap/trap.cfg</span></tt> and
<tt class="file docutils literal"><span class="pre">/home/evert/work/trap/jobs/example/control/tasks.cfg</span></tt>.</p>
<p>The recipes directory,
<tt class="file docutils literal"><span class="pre">$</span><em><span class="pre">TKP</span></em><span class="pre">/lib/python2.6/site-packages/trap/recipes</span></tt>, contains practical
recipes for the TRAP; these are in the master and nodes subdirectories
(frontend and compute node recipes). The SIP recipes can be found in
<tt class="file docutils literal"><span class="pre">/opt/LofIm/lofar/lib/python2.6/dist-packages/lofarpipe/recipes</span></tt>, but
some of these have a slightly adjusted variant in the TKP recipes directory.
The main TKP recipes directory also contains an example <cite>trap-images.py</cite>
recipe which takes a list of images as input and searches them for transients.</p>
<p>It is assumed you know how to edit the <tt class="file docutils literal"><span class="pre">trap.cfg</span></tt> and <tt class="file docutils literal"><span class="pre">tasks.cfg</span></tt>
files, as well as set up parset and other files. For simplicity,
however, the example files mentioned in the <a class="reference internal" href="recipes.html#recipes-section"><em>recipes section</em></a> can be used.</p>
<div class="section" id="simple-way">
<span id="heastro-simple-way"></span><h3>Simple way<a class="headerlink" href="#simple-way" title="Permalink to this headline">¶</a></h3>
<p>(For simplicity, me, myself and I in the following will simply refer to the
current author of this document.)</p>
<p>This describes a copy-paste way to get the trap running on heastro1 or
heastro2, essentially by copying my setup and adjust a few PATHs
accordingly. The PATH set up is done slightly different than the
previous section, but in essence is the same.</p>
<p>Firstly, lay out the usual pipeline directory structure:</p>
<div class="highlight-python"><pre>$HOME/work/trap/jobs/&lt;job-id&gt;</pre>
</div>
<p>where job-id is probably named after the dataset you want to process.</p>
<p>Copy the directory and subdirs from <tt class="docutils literal"><span class="pre">~evert/work/trap/jobs/example/</span></tt> into this directory:</p>
<div class="highlight-python"><pre>cp -r ~evert/work/trap/jobs/example/*  $HOME/work/trap/jobs/&lt;job-id&gt;/.</pre>
</div>
<p>And copy the trap configuration file:</p>
<div class="highlight-python"><pre>cp -r ~evert/work/trap/trap.cfg  $HOME/work/trap/trap.cfg</pre>
</div>
<p>You should now have the following structure:</p>
<div class="highlight-python"><pre>$HOME/work/trap/trap.cfg
$HOME/work/trap/jobs/&lt;job-id&gt;/
                              control/
                              parset/
                              vds/
                              results/
                              logs/</pre>
</div>
<p>The results, logs and vds directories will be empty.</p>
<p>Now edit trap.cfg. Only a few edits will be necessary. In particular, check:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">runtime_directory</span></tt></li>
<li><tt class="docutils literal"><span class="pre">lofarroot</span></tt></li>
<li><tt class="docutils literal"><span class="pre">default_working_directory</span></tt></li>
</ul>
<p>You can use my cluster description file and recipes directories.  If
you have your own MonetDB database, change the login details in the
<tt class="docutils literal"><span class="pre">[database]</span></tt> section accordingly, otherwise use mine or the default
scratch one: tkp/tkp/tkp.</p>
<p>Now edit <tt class="file docutils literal"><span class="pre">control/runtrap.sh</span></tt>. This is a simple script that
first clears directories (since the pipeline won&#8217;t clobber existing
files normally), and then runs the TRAP with the correct job ID. Edit
the paths accordingly. Don&#8217;t forget to change the job name (value to
-j option) as well!</p>
<p>Now edit the <tt class="file docutils literal"><span class="pre">control/tasks.cfg</span></tt> file as necessary. In
particular, pay attention to the database credentials: for BBS, set
<tt class="docutils literal"><span class="pre">db_name</span></tt> to your user name; for the skymodel databse (MonetDB), you
can use the tkp/tkp/tkp scratch database, or the default I&#8217;m using.</p>
<p>Last things to edit are the <tt class="file docutils literal"><span class="pre">control/to_process.py</span></tt> or
<tt class="file docutils literal"><span class="pre">control/images_to_process.py</span></tt> files and the various
parsets. Once you are happy with all settings, you can run the trap
with:</p>
<div class="highlight-python"><pre>./runtrap.sh</pre>
</div>
</div>
</div>
<div class="section" id="additional-setup">
<h2>Additional setup<a class="headerlink" href="#additional-setup" title="Permalink to this headline">¶</a></h2>
<div class="section" id="passwordless-ssh">
<h3>Passwordless ssh<a class="headerlink" href="#passwordless-ssh" title="Permalink to this headline">¶</a></h3>
<p>When using the pipeline over the cluster, it generally uses ssh connections.
Since you do not want to type in your password for every connection it makes,
you create authorization keys with a blank password (if you find that insecure,
you can also use something like ssh-agent to store the password. On most
clusters, however, the security comes from your initial login to the frontend
node anyway). To do this:</p>
<div class="highlight-python"><pre>$&gt; ssh-keygen -t dsa</pre>
</div>
<p>Enter a blank password (just press return). Then:</p>
<div class="highlight-python"><pre>$&gt; cat ~/.ssh/id_dsa.pub &gt;&gt; ~/.ssh/authorized_keys</pre>
</div>
<p>Since the <cite>.ssh</cite> directory is located in your home directory, the
<cite>authorized_keys</cite> file is available on all cluster nodes, and you should now
have a passwordless login to every cluster node.</p>
<p>You also want to disable the host key check that ssh performs every first time
you log in to a node. You can do that by setting StrictHostKeyChecking to
&#8216;no&#8217;:</p>
<div class="highlight-python"><pre>$&gt; cat &gt;&gt; ~/.ssh/config
StrictHostKeyChecking no
&lt;ctrl-D&gt;</pre>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
    <p class="logo"><a href="index.html">
      <img class="logo" src="_static/ackbar.png" alt="Ackbar" title="It's a TRAP!" />
    </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Setup</a><ul>
<li><a class="reference internal" href="#preamble">Preamble</a></li>
<li><a class="reference internal" href="#on-heastro">On heastro</a><ul>
<li><a class="reference internal" href="#simple-way">Simple way</a></li>
</ul>
</li>
<li><a class="reference internal" href="#additional-setup">Additional setup</a><ul>
<li><a class="reference internal" href="#passwordless-ssh">Passwordless ssh</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="installation.html"
                        title="previous chapter">Installation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="scripts.html"
                        title="next chapter">Scripts</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/setup.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="scripts.html" title="Scripts"
             >next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             >previous</a> |</li>
        <li><a href="index.html">TRAP 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, LOFAR Transients Key Project.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>